<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin Panel - GIVASTORE.ID</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="image/icon.jpg" type="image/jpeg">
    
    <style>
        /* CSS Reset untuk kompatibilitas */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
        }

        /* Import Font Pricedown */
        @font-face {
            font-family: 'Pricedown';
            src: url('pricedown bl.woff2') format('woff2'),
                 url('pricedown bl.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        /* Color Variables */
        :root {
            --primary: #0A1931;
            --primary-alt: #152C5B;
            --accent: #1E40AF;
            --secondary: #3B82F6;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --info: #3B82F6;
            --dark: #1F2937;
            --light: #F9FAFB;
            --sidebar: #0A1931;
            --sidebar-hover: #152C5B;
            --text-dark: #111827;
            --text: #374151;
            --text-light: #6B7280;
            --border: #E5E7EB;
            --radius: 8px;
            --radius-lg: 12px;
            --shadow: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
        }

        html {
            height: 100%;
            font-size: 16px;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--light);
            color: var(--text);
            line-height: 1.5;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Admin Layout */
        .admin-container {
            display: flex;
            min-height: 100vh;
            position: relative;
        }

        /* Sidebar */
        .admin-sidebar {
            width: 260px;
            min-width: 260px;
            background: var(--sidebar);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 1000;
            -webkit-overflow-scrolling: touch;
        }

        .sidebar-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: sticky;
            top: 0;
            background: var(--sidebar);
            z-index: 10;
        }

        .brand-text {
            font-family: 'Pricedown', 'Poppins', sans-serif;
            font-size: 1.8rem;
            color: white;
            letter-spacing: 1px;
            line-height: 1.2;
        }

        .brand-subtitle {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 0.25rem;
        }

        .sidebar-menu {
            padding: 1rem 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.85rem 1.5rem;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .menu-item:hover,
        .menu-item.active {
            background: var(--sidebar-hover);
            color: white;
            border-left-color: var(--accent);
        }

        .menu-item i {
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        .menu-item span {
            font-size: 0.9rem;
            font-weight: 500;
            flex: 1;
        }

        .sidebar-footer {
            padding: 1.25rem 1.5rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            margin-top: auto;
            position: sticky;
            bottom: 0;
            background: var(--sidebar);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            min-width: 40px;
            border-radius: 50%;
            background: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1rem;
        }

        .user-details h4 {
            font-size: 0.9rem;
            font-weight: 600;
            line-height: 1.3;
        }

        .user-details p {
            font-size: 0.75rem;
            opacity: 0.7;
            line-height: 1.2;
        }

        /* Main Content */
        .admin-main {
            flex: 1;
            margin-left: 260px;
            padding: 1rem;
            transition: margin-left 0.3s ease, padding 0.3s ease;
            width: calc(100% - 260px);
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 1rem;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
            line-height: 1.2;
            flex: 1;
            min-width: 200px;
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        /* Button Styles */
        .btn {
            padding: 0.6rem 1.2rem;
            border-radius: var(--radius);
            border: none;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            line-height: 1.2;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
            border: 1px solid var(--accent);
        }

        .btn-primary:hover,
        .btn-primary:focus {
            background: var(--primary-alt);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.2);
        }

        .btn-success {
            background: var(--success);
            color: white;
            border: 1px solid var(--success);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            border: 1px solid var(--danger);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
        }

        .btn-outline:hover {
            background: var(--light);
            border-color: var(--accent);
        }

        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.25rem;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--border);
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            margin-bottom: 1rem;
        }

        .stat-icon.total { background: rgba(59, 130, 246, 0.1); color: var(--info); }
        .stat-icon.active { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .stat-icon.sold-out { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .stat-icon.categories { background: rgba(245, 158, 11, 0.1); color: var(--warning); }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
            line-height: 1.2;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        /* Table Container */
        .table-container {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        thead {
            background: var(--light);
        }

        th {
            padding: 0.875rem 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-dark);
            border-bottom: 1px solid var(--border);
            white-space: nowrap;
        }

        td {
            padding: 0.875rem 1rem;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }

        .product-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            min-width: 250px;
        }

        .product-image {
            width: 48px;
            height: 48px;
            min-width: 48px;
            border-radius: 8px;
            object-fit: cover;
            background: var(--light);
        }

        .product-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.2rem;
            line-height: 1.3;
            word-break: break-word;
        }

        .product-category {
            font-size: 0.75rem;
            color: var(--text-light);
            background: var(--light);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            display: inline-block;
            border: 1px solid var(--border);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
            white-space: nowrap;
        }

        .status-active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .status-sold-out {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .status-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .price {
            font-weight: 600;
            color: var(--text-dark);
            white-space: nowrap;
        }

        .actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            min-width: 36px;
            border-radius: 6px;
            border: none;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            -webkit-tap-highlight-color: transparent;
        }

        .btn-edit {
            color: var(--info);
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .btn-edit:hover,
        .btn-edit:focus {
            background: var(--info);
            color: white;
            border-color: var(--info);
        }

        .btn-delete {
            color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .btn-delete:hover,
        .btn-delete:focus {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        .btn-package {
            color: var(--warning);
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .btn-package:hover,
        .btn-package:focus {
            background: var(--warning);
            color: white;
            border-color: var(--warning);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            animation: modalFadeIn 0.3s ease;
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlide 0.3s ease;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 1px solid var(--border);
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-dark);
            line-height: 1.3;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .modal-close:hover {
            background: var(--light);
            color: var(--danger);
        }

        .modal-body {
            padding: 1.5rem;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-dark);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 0.9rem;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .form-text {
            font-size: 0.75rem;
            color: var(--text-light);
            margin-top: 0.25rem;
            line-height: 1.3;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        textarea.form-control {
            resize: vertical;
            min-height: 100px;
        }

        /* Image Preview */
        .image-preview {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            object-fit: cover;
            border: 2px dashed var(--border);
            display: block;
            margin-bottom: 1rem;
            background: var(--light);
        }

        /* File Input */
        .file-input {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-input input[type="file"] {
            position: absolute;
            top: 0;
            right: 0;
            margin: 0;
            padding: 0;
            font-size: 20px;
            cursor: pointer;
            opacity: 0;
            width: 100%;
            height: 100%;
        }

        .file-input-label {
            display: inline-block;
            padding: 0.75rem 1rem;
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text);
            text-align: center;
            width: 100%;
            transition: all 0.3s ease;
        }

        .file-input-label:hover {
            background: #e5e7eb;
            border-color: var(--accent);
        }

        /* Package Manager */
        .package-list {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .package-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            background: var(--light);
        }

        .package-item:last-child {
            border-bottom: none;
        }

        .package-item-header {
            background: white;
            font-weight: 600;
            color: var(--text-dark);
        }

        .package-field {
            flex: 1;
        }

        .package-field input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 0.9rem;
        }

        .package-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Image Manager */
        .image-manager {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .image-item {
            position: relative;
            border-radius: var(--radius);
            overflow: hidden;
            border: 1px solid var(--border);
            background: white;
        }

        .image-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            display: block;
            background: var(--light);
        }

        .image-actions {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            padding: 0.5rem;
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .image-item:hover .image-actions {
            transform: translateY(0);
        }

        /* Banner Manager */
        .banner-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .banner-item {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: transform 0.3s ease;
        }

        .banner-item:hover {
            transform: translateY(-3px);
        }

        .banner-image {
            width: 100%;
            height: 140px;
            object-fit: cover;
            background: var(--light);
        }

        .banner-info {
            padding: 1rem;
        }

        .banner-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 1rem;
            color: var(--text-dark);
        }

        /* Page Content */
        .page-content {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.25rem;
            border-radius: var(--radius);
            background: white;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            z-index: 3000;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            max-width: 350px;
            border-left: 4px solid var(--success);
            border: 1px solid var(--border);
        }

        .notification.active {
            transform: translateX(0);
        }

        .notification.success {
            border-left-color: var(--success);
        }

        .notification.error {
            border-left-color: var(--danger);
        }

        .notification.warning {
            border-left-color: var(--warning);
        }

        .notification-icon {
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .notification.success .notification-icon {
            color: var(--success);
        }

        .notification.error .notification-icon {
            color: var(--danger);
        }

        .notification.warning .notification-icon {
            color: var(--warning);
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-dark);
            cursor: pointer;
            width: 44px;
            height: 44px;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius);
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .mobile-menu-toggle:hover {
            background: var(--light);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .admin-main {
                padding: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }

        @media (max-width: 992px) {
            .admin-sidebar {
                transform: translateX(-100%);
            }
            
            .admin-sidebar.active {
                transform: translateX(0);
                box-shadow: 5px 0 30px rgba(0,0,0,0.2);
            }
            
            .admin-main {
                margin-left: 0;
                width: 100%;
                padding: 0.75rem;
            }
            
            .mobile-menu-toggle {
                display: flex;
            }
            
            .page-title {
                font-size: 1.25rem;
            }
            
            .modal-content {
                max-width: 95%;
            }
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .header-actions {
                width: 100%;
                justify-content: flex-start;
            }
            
            .btn {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
                flex: 1;
                min-width: 120px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-card {
                padding: 1rem;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
            
            table {
                font-size: 0.9rem;
            }
            
            th, td {
                padding: 0.75rem 0.5rem;
            }
            
            .actions {
                flex-direction: row;
            }
            
            .btn-icon {
                width: 32px;
                height: 32px;
                min-width: 32px;
            }
            
            .modal-body {
                padding: 1rem;
            }
            
            .image-manager {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 0.75rem;
            }
            
            .banner-grid {
                grid-template-columns: 1fr;
            }
            
            .notification {
                left: 20px;
                right: 20px;
                max-width: none;
                top: 10px;
            }
            
            .package-item {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .package-field {
                width: 100%;
            }
            
            .package-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }

        @media (max-width: 480px) {
            .admin-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }
            
            .page-title {
                min-width: auto;
                width: 100%;
            }
            
            .header-actions {
                width: 100%;
            }
            
            .btn {
                min-width: 100px;
                padding: 0.6rem 0.75rem;
            }
            
            .product-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .product-image {
                width: 40px;
                height: 40px;
                min-width: 40px;
            }
            
            .modal-header {
                padding: 1rem;
            }
            
            .modal-title {
                font-size: 1.1rem;
            }
            
            .modal-close {
                width: 32px;
                height: 32px;
                font-size: 1.25rem;
            }
        }

        @media (max-width: 360px) {
            .admin-main {
                padding: 0.5rem;
            }
            
            .btn {
                font-size: 0.8rem;
                padding: 0.5rem 0.6rem;
            }
            
            .stat-card {
                padding: 0.75rem;
            }
            
            .image-manager {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Touch Device Optimizations */
        @media (hover: none) and (pointer: coarse) {
            .menu-item:hover {
                background: transparent;
            }
            
            .menu-item.active {
                background: var(--sidebar-hover);
            }
            
            .btn:hover,
            .btn-icon:hover {
                transform: none;
            }
            
            .image-item:hover .image-actions {
                transform: translateY(100%);
            }
            
            .image-item:active .image-actions {
                transform: translateY(0);
            }
            
            .stat-card:hover {
                transform: none;
            }
            
            .banner-item:hover {
                transform: none;
            }
            
            /* Increase tap targets for mobile */
            .menu-item {
                padding: 1rem 1.5rem;
            }
            
            .btn {
                min-height: 44px;
            }
            
            .btn-icon {
                min-width: 44px;
                min-height: 44px;
            }
            
            .modal-close {
                min-width: 44px;
                min-height: 44px;
            }
            
            input[type="number"],
            input[type="text"],
            input[type="email"],
            select,
            textarea {
                font-size: 16px; /* Prevent zoom on iOS */
            }
        }

        /* Print Styles */
        @media print {
            .admin-sidebar,
            .mobile-menu-toggle,
            .header-actions,
            .actions,
            .modal,
            .notification {
                display: none !important;
            }
            
            .admin-main {
                margin-left: 0;
                width: 100%;
            }
            
            .table-container {
                box-shadow: none;
                border: 1px solid #000;
            }
            
            .stat-card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #000;
            }
        }

        /* High Contrast Mode Support */
        @media (prefers-contrast: high) {
            :root {
                --border: #000000;
                --text-light: #000000;
            }
            
            .stat-card,
            .table-container,
            .modal-content {
                border: 2px solid #000000;
            }
        }

        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="admin-sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="brand-text">GIVASTORE</div>
                <div class="brand-subtitle">Admin Panel</div>
            </div>
            
            <div class="sidebar-menu">
                <a href="#" class="menu-item active" data-page="dashboard">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="menu-item" data-page="products">
                    <i class="fas fa-box"></i>
                    <span>Kelola Produk</span>
                </a>
                <a href="#" class="menu-item" data-page="categories">
                    <i class="fas fa-tags"></i>
                    <span>Kategori</span>
                </a>
                <a href="#" class="menu-item" data-page="images">
                    <i class="fas fa-images"></i>
                    <span>Gambar Produk</span>
                </a>
                <a href="#" class="menu-item" data-page="banners">
                    <i class="fas fa-image"></i>
                    <span>Banner</span>
                </a>
                <a href="#" class="menu-item" data-page="stock">
                    <i class="fas fa-warehouse"></i>
                    <span>Kelola Stok</span>
                </a>
                <a href="#" class="menu-item" data-page="orders">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Pesanan</span>
                </a>
                <a href="#" class="menu-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Pengaturan</span>
                </a>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">A</div>
                    <div class="user-details">
                        <h4>Admin GIVASTORE</h4>
                        <p>Super Administrator</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="admin-main">
            <div class="admin-header">
                <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="page-title" id="pageTitle">Dashboard</h1>
                <div class="header-actions">
                    <button class="btn btn-outline" id="syncProductsBtn">
                        <i class="fas fa-sync"></i> Sync Products
                    </button>
                    <button class="btn btn-outline" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>

            <!-- Dashboard Content -->
            <div id="dashboardContent" class="page-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon total">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-value" id="totalProducts">0</div>
                        <div class="stat-label">Total Produk</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon active">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-value" id="activeProducts">0</div>
                        <div class="stat-label">Produk Aktif</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon sold-out">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="stat-value" id="soldOutProducts">0</div>
                        <div class="stat-label">Habis Terjual</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon categories">
                            <i class="fas fa-tags"></i>
                        </div>
                        <div class="stat-value" id="totalCategories">0</div>
                        <div class="stat-label">Kategori</div>
                    </div>
                </div>

                <div class="table-container">
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Produk</th>
                                    <th>Kategori</th>
                                    <th>Harga</th>
                                    <th>Stok</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                                <!-- Data akan diisi JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Products Management -->
            <div id="productsContent" class="page-content" style="display: none;">
                <div style="margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                    <h2 style="font-size: 1.25rem; color: var(--text-dark); margin: 0;">Kelola Produk</h2>
                    <button class="btn btn-primary" id="addProductBtn">
                        <i class="fas fa-plus"></i> Tambah Produk
                    </button>
                </div>
                
                <div class="table-container">
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Produk</th>
                                    <th>Kategori</th>
                                    <th>Harga</th>
                                    <th>Stok</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="productsListBody">
                                <!-- Data akan diisi JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Categories Management -->
            <div id="categoriesContent" class="page-content" style="display: none;">
                <div style="margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                    <h2 style="font-size: 1.25rem; color: var(--text-dark); margin: 0;">Kelola Kategori</h2>
                    <button class="btn btn-primary" id="addCategoryBtn">
                        <i class="fas fa-plus"></i> Tambah Kategori
                    </button>
                </div>
                
                <div class="table-container">
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nama Kategori</th>
                                    <th>Jumlah Produk</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="categoriesListBody">
                                <!-- Data akan diisi JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Images Management -->
            <div id="imagesContent" class="page-content" style="display: none;">
                <h2 style="font-size: 1.25rem; color: var(--text-dark); margin-bottom: 1.5rem;">Kelola Gambar Produk</h2>
                
                <div class="image-manager" id="imageManager">
                    <!-- Gambar akan diisi JavaScript -->
                </div>
                
                <div style="margin-top: 1.5rem;">
                    <label class="form-label">Upload Gambar Baru</label>
                    <div class="file-input">
                        <input type="file" id="uploadImage" accept="image/*" multiple>
                        <label class="file-input-label" for="uploadImage">
                            <i class="fas fa-upload"></i> Pilih Gambar
                        </label>
                    </div>
                </div>
            </div>

            <!-- Banners Management -->
            <div id="bannersContent" class="page-content" style="display: none;">
                <h2 style="font-size: 1.25rem; color: var(--text-dark); margin-bottom: 1.5rem;">Kelola Banner</h2>
                
                <div class="banner-grid" id="bannerGrid">
                    <!-- Banner akan diisi JavaScript -->
                </div>
                
                <div style="margin-top: 1.5rem;">
                    <button class="btn btn-primary" id="addBannerBtn">
                        <i class="fas fa-plus"></i> Tambah Banner
                    </button>
                </div>
            </div>

            <!-- Stock Management -->
            <div id="stockContent" class="page-content" style="display: none;">
                <h2 style="font-size: 1.25rem; color: var(--text-dark); margin-bottom: 1.5rem;">Kelola Stok Produk</h2>
                
                <div class="table-container">
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Produk</th>
                                    <th>Stok Saat Ini</th>
                                    <th>Status</th>
                                    <th>Update Stok</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="stockListBody">
                                <!-- Data akan diisi JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Orders Management -->
            <div id="ordersContent" class="page-content" style="display: none;">
                <h2 style="font-size: 1.25rem; color: var(--text-dark); margin-bottom: 1.5rem;">Pesanan Terbaru</h2>
                <div class="table-container">
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID Pesanan</th>
                                    <th>Produk</th>
                                    <th>Customer</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Tanggal</th>
                                </tr>
                            </thead>
                            <tbody id="ordersListBody">
                                <!-- Data akan diisi JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings -->
            <div id="settingsContent" class="page-content" style="display: none;">
                <h2 style="font-size: 1.25rem; color: var(--text-dark); margin-bottom: 1.5rem;">Pengaturan</h2>
                
                <div class="form-group">
                    <label class="form-label">Nama Toko</label>
                    <input type="text" class="form-control" id="storeName" value="GIVASTORE.ID">
                </div>
                
                <div class="form-group">
                    <label class="form-label">WhatsApp Admin</label>
                    <input type="text" class="form-control" id="adminWhatsApp" value="6285189139082">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email Admin</label>
                    <input type="email" class="form-control" id="adminEmail" value="xyzopedia@gmail.com">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Auto Redirect ke Sold Page</label>
                    <select class="form-control" id="autoRedirect">
                        <option value="yes">Ya - Otomatis redirect saat stok habis</option>
                        <option value="no">Tidak - Tampilkan pesan stok habis</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" id="saveSettings">
                    <i class="fas fa-save"></i> Simpan Pengaturan
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Add/Edit Product -->
    <div class="modal" id="productModal" role="dialog" aria-labelledby="productModalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="productModalTitle">Tambah Produk Baru</h3>
                <button class="modal-close" id="closeProductModal" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <div class="form-group">
                        <label class="form-label" for="productName">Nama Produk</label>
                        <input type="text" class="form-control" id="productName" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="productCategory">Kategori</label>
                            <select class="form-control" id="productCategory" required>
                                <!-- Kategori akan diisi JavaScript -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="productPrice">Harga</label>
                            <input type="number" class="form-control" id="productPrice" required min="0">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="productOriginalPrice">Harga Asli</label>
                            <input type="number" class="form-control" id="productOriginalPrice" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="productStock">Stok</label>
                            <input type="number" class="form-control" id="productStock" required min="0" value="10">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Gambar Produk</label>
                        <img src="https://via.placeholder.com/100/1E40AF/FFFFFF?text=Produk" alt="Preview" class="image-preview" id="productImagePreview">
                        <div class="file-input">
                            <input type="file" id="productImage" accept="image/*">
                            <label class="file-input-label" for="productImage">
                                <i class="fas fa-upload"></i> Pilih Gambar
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="productUrl">URL Halaman Produk</label>
                        <input type="text" class="form-control" id="productUrl" placeholder="product.html?id=...">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="productDescription">Deskripsi</label>
                        <textarea class="form-control" id="productDescription" rows="3"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="productFlashSale">Flash Sale</label>
                            <select class="form-control" id="productFlashSale">
                                <option value="no">Tidak</option>
                                <option value="yes">Ya</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="productPopular">Produk Populer</label>
                            <select class="form-control" id="productPopular">
                                <option value="no">Tidak</option>
                                <option value="yes">Ya</option>
                            </select>
                        </div>
                    </div>
                    
                    <input type="hidden" id="productId">
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
                        <button type="button" class="btn btn-outline" id="cancelProduct">Batal</button>
                        <button type="submit" class="btn btn-primary">Simpan Produk</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Manage Packages -->
    <div class="modal" id="packagesModal" role="dialog" aria-labelledby="packagesModalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="packagesModalTitle">Kelola Paket Produk</h3>
                <button class="modal-close" id="closePackagesModal" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 1rem;">
                    <h4 style="color: var(--text-dark); margin-bottom: 0.5rem;" id="productNameTitle">Nama Produk</h4>
                    <p style="color: var(--text-light); font-size: 0.9rem;" id="productCategoryTitle">Kategori: -</p>
                </div>
                
                <div class="package-list" id="packagesList">
                    <div class="package-item package-item-header">
                        <div class="package-field">Nama Paket</div>
                        <div class="package-field">Harga</div>
                        <div class="package-field">Durasi</div>
                        <div class="package-field">Aksi</div>
                    </div>
                    <!-- Paket akan diisi JavaScript -->
                </div>
                
                <div style="margin-top: 1.5rem;">
                    <h4 style="color: var(--text-dark); margin-bottom: 1rem;">Tambah Paket Baru</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Nama Paket</label>
                            <input type="text" class="form-control" id="newPackageName" placeholder="Contoh: Netflix Sharing 1P1U">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Harga</label>
                            <input type="number" class="form-control" id="newPackagePrice" placeholder="Contoh: 20000" min="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Durasi</label>
                            <input type="text" class="form-control" id="newPackageDuration" placeholder="Contoh: 1 BULAN">
                        </div>
                    </div>
                    <button class="btn btn-success" id="addPackageBtn">
                        <i class="fas fa-plus"></i> Tambah Paket
                    </button>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap;">
                    <button type="button" class="btn btn-outline" id="cancelPackages">Batal</button>
                    <button type="button" class="btn btn-primary" id="savePackages">Simpan Paket</button>
                </div>
                
                <input type="hidden" id="currentProductId">
            </div>
        </div>
    </div>

    <!-- Modal Add/Edit Category -->
    <div class="modal" id="categoryModal" role="dialog" aria-labelledby="categoryModalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="categoryModalTitle">Tambah Kategori Baru</h3>
                <button class="modal-close" id="closeCategoryModal" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="categoryForm">
                    <div class="form-group">
                        <label class="form-label" for="categoryName">Nama Kategori</label>
                        <input type="text" class="form-control" id="categoryName" required>
                    </div>
                    
                    <input type="hidden" id="categoryId">
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
                        <button type="button" class="btn btn-outline" id="cancelCategory">Batal</button>
                        <button type="submit" class="btn btn-primary">Simpan Kategori</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Add/Edit Banner -->
    <div class="modal" id="bannerModal" role="dialog" aria-labelledby="bannerModalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="bannerModalTitle">Tambah Banner Baru</h3>
                <button class="modal-close" id="closeBannerModal" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="bannerForm">
                    <div class="form-group">
                        <label class="form-label" for="bannerTitle">Nama Banner</label>
                            <input type="text" class="form-control" id="bannerTitle" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Gambar Banner</label>
                        <img src="https://via.placeholder.com/300x100/0A1931/FFFFFF?text=Banner" alt="Preview" class="image-preview" id="bannerImagePreview" style="width: 100%; height: 150px;">
                        <div class="file-input">
                            <input type="file" id="bannerImage" accept="image/*">
                            <label class="file-input-label" for="bannerImage">
                                <i class="fas fa-upload"></i> Pilih Gambar Banner
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="bannerUrl">Link URL</label>
                        <input type="text" class="form-control" id="bannerUrl" placeholder="https://...">
                    </div>
                    
                    <input type="hidden" id="bannerId">
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
                        <button type="button" class="btn btn-outline" id="cancelBanner">Batal</button>
                        <button type="submit" class="btn btn-primary">Simpan Banner</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification" role="alert" aria-live="polite">
        <i class="fas fa-check-circle notification-icon"></i>
        <span id="notificationMessage">Data berhasil disimpan!</span>
    </div>

    <!-- Load Scripts -->
    <script src="js/produk.js"></script>
    <script src="js/products-data.js"></script>
    <script src="js/stock-sync.js"></script>
    
    <script>
        // Data Storage
        let products = [];
        let categories = [];
        let banners = [];
        let images = [];
        let orders = [];

        // DOM Elements
        const sidebar = document.getElementById('sidebar');
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const pageTitle = document.getElementById('pageTitle');
        const pageContents = document.querySelectorAll('.page-content');
        const menuItems = document.querySelectorAll('.menu-item');
        const syncProductsBtn = document.getElementById('syncProductsBtn');
        
        // Modal Elements
        const productModal = document.getElementById('productModal');
        const packagesModal = document.getElementById('packagesModal');
        const categoryModal = document.getElementById('categoryModal');
        const bannerModal = document.getElementById('bannerModal');
        
        // Notification
        const notification = document.getElementById('notification');
        const notificationMessage = document.getElementById('notificationMessage');

        // ==================== FUNGSI LOAD PRODUK DARI FILE ====================
        
        function loadProductsFromAllSources() {
            console.log(' Memuat produk dari semua sumber...');
            
            const loadedProducts = [];
            const seenProducts = new Set();
            let productId = 1;
            
            // SUMBER 1: Dari produk.js (semuaProduk)
            if (typeof semuaProduk !== 'undefined') {
                console.log(' Sumber 1: Memuat dari produk.js');
                
                Object.keys(semuaProduk).forEach(key => {
                    const product = semuaProduk[key];
                    const productKey = product.name.toLowerCase().trim();
                    
                    if (!seenProducts.has(productKey)) {
                        // Ambil harga terendah dari packages untuk harga utama
                        const packages = product.packages || [];
                        const minPrice = packages.length > 0 ? 
                            Math.min(...packages.map(p => p.price || 0)) : 0;
                        
                        // Ambil harga tertinggi untuk original price
                        const maxPrice = packages.length > 0 ? 
                            Math.max(...packages.map(p => p.price || 0)) : minPrice * 2;
                        
                        loadedProducts.push({
                            id: productId++,
                            name: product.name,
                            category: product.category || 'Streaming',
                            price: minPrice, // Harga utama = harga paket termurah
                            originalPrice: maxPrice * 1.5 > minPrice ? maxPrice * 1.5 : minPrice * 2,
                            image: product.logo || product.bannerImage || `https://via.placeholder.com/150/1E40AF/FFFFFF?text=${encodeURIComponent(product.name.substring(0, 10))}`,
                            stock: 10, // Default stock
                            status: 'active',
                            isFlashSale: false,
                            isPopular: ['Netflix', 'Spotify', 'Canva', 'Youtube', 'Alight Motion', 'Vidio'].includes(product.name),
                            pageUrl: `../pages/product.html?product=${encodeURIComponent(product.name)}`,
                            description: product.description || `Paket ${product.name} premium dengan akses penuh`,
                            packages: packages, // Simpan paket asli dari file
                            source: 'produk.js'
                        });
                        
                        seenProducts.add(productKey);
                    }
                });
            }
            
            // SUMBER 2: Dari products-data.js (window.productData)
            if (typeof window.productData !== 'undefined' && window.productData.products) {
                console.log(' Sumber 2: Memuat dari products-data.js');
                
                window.productData.products.forEach(product => {
                    const productKey = product.name.toLowerCase().trim();
                    
                    if (!seenProducts.has(productKey)) {
                        // Coba cari paket dari produk.js untuk produk ini
                        let packages = [];
                        if (typeof semuaProduk !== 'undefined') {
                            const matchingProduct = Object.values(semuaProduk).find(p => 
                                p.name.toLowerCase() === product.name.toLowerCase()
                            );
                            if (matchingProduct && matchingProduct.packages) {
                                packages = matchingProduct.packages;
                            }
                        }
                        
                        loadedProducts.push({
                            id: productId++,
                            name: product.name,
                            category: product.category || 'Streaming',
                            price: product.price || 0,
                            originalPrice: product.originalPrice || product.price * 2,
                            image: product.image || `https://via.placeholder.com/150/1E40AF/FFFFFF?text=${encodeURIComponent(product.name.substring(0, 10))}`,
                            stock: product.stock || 0,
                            status: product.status || (product.stock > 0 ? 'active' : 'sold-out'),
                            isFlashSale: product.isFlashSale || false,
                            isPopular: product.isPopular || false,
                            pageUrl: product.pageUrl || `../pages/product.html?product=${encodeURIComponent(product.name)}`,
                            description: product.description || '',
                            sold: product.sold || 0,
                            packages: packages, // Tambahkan paket jika ditemukan
                            source: 'products-data.js'
                        });
                        
                        seenProducts.add(productKey);
                    }
                });
            }
            
            console.log(` Total produk dimuat: ${loadedProducts.length}`);
            return loadedProducts;
        }

        function loadCategoriesFromProducts(products) {
            const categorySet = new Set();
            const categoryCounts = {};
            
            products.forEach(product => {
                if (product.category) {
                    categorySet.add(product.category);
                    categoryCounts[product.category] = (categoryCounts[product.category] || 0) + 1;
                }
            });
            
            const categories = [];
            let categoryId = 1;
            
            categorySet.forEach(categoryName => {
                categories.push({
                    id: categoryId++,
                    name: categoryName,
                    count: categoryCounts[categoryName] || 0
                });
            });
            
            // Tambahkan kategori default jika kosong
            if (categories.length === 0) {
                categories.push(
                    { id: 1, name: "Streaming", count: 0 },
                    { id: 2, name: "Musik", count: 0 },
                    { id: 3, name: "Editing", count: 0 },
                    { id: 4, name: "AI", count: 0 }
                );
            }
            
            return categories;
        }

        // ==================== FUNGSI UNTUK PAKET ====================
        
        function openManagePackages(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            // Set judul modal
            document.getElementById('productNameTitle').textContent = product.name;
            document.getElementById('productCategoryTitle').textContent = `Kategori: ${product.category}`;
            document.getElementById('currentProductId').value = productId;
            
            // Load paket ke modal
            loadPackagesToModal(product.packages || []);
            
            // Tampilkan modal
            packagesModal.classList.add('active');
            packagesModal.setAttribute('aria-hidden', 'false');
        }
        
        function loadPackagesToModal(packages) {
            const packagesList = document.getElementById('packagesList');
            // Hapus semua paket kecuali header
            while (packagesList.children.length > 1) {
                packagesList.removeChild(packagesList.lastChild);
            }
            
            // Tambahkan paket yang ada
            packages.forEach((pkg, index) => {
                addPackageToModal(pkg.name, pkg.price, pkg.duration, index);
            });
        }
        
        function addPackageToModal(name = '', price = '', duration = '', index = null) {
            const packagesList = document.getElementById('packagesList');
            
            const packageItem = document.createElement('div');
            packageItem.className = 'package-item';
            packageItem.dataset.index = index !== null ? index : packagesList.children.length - 1;
            
            packageItem.innerHTML = `
                <div class="package-field">
                    <input type="text" class="package-name" value="${name}" placeholder="Nama Paket">
                </div>
                <div class="package-field">
                    <input type="number" class="package-price" value="${price}" placeholder="Harga" min="0">
                </div>
                <div class="package-field">
                    <input type="text" class="package-duration" value="${duration}" placeholder="Durasi">
                </div>
                <div class="package-actions">
                    <button type="button" class="btn-icon btn-danger" onclick="removePackage(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            packagesList.appendChild(packageItem);
        }
        
        function removePackage(button) {
            const packageItem = button.closest('.package-item');
            packageItem.remove();
        }
        
        function savePackages() {
            const productId = parseInt(document.getElementById('currentProductId').value);
            const productIndex = products.findIndex(p => p.id === productId);
            
            if (productIndex === -1) return;
            
            // Kumpulkan semua paket dari modal
            const packages = [];
            const packageItems = document.querySelectorAll('.package-item:not(.package-item-header)');
            
            packageItems.forEach(item => {
                const name = item.querySelector('.package-name').value.trim();
                const price = parseInt(item.querySelector('.package-price').value) || 0;
                const duration = item.querySelector('.package-duration').value.trim();
                
                if (name && price > 0 && duration) {
                    packages.push({
                        name: name,
                        price: price,
                        duration: duration
                    });
                }
            });
            
            // Simpan paket ke produk
            products[productIndex].packages = packages;
            
            // Update harga utama berdasarkan paket termurah
            if (packages.length > 0) {
                const minPrice = Math.min(...packages.map(p => p.price));
                products[productIndex].price = minPrice;
                
                // Update harga asli berdasarkan paket termahal
                const maxPrice = Math.max(...packages.map(p => p.price));
                products[productIndex].originalPrice = maxPrice * 1.5;
            }
            
            saveProducts();
            showNotification('Paket berhasil disimpan');
            closePackagesModal();
            
            // Refresh tampilan produk
            loadProductsManagement();
            loadDashboardProducts();
            updateStats();
        }
        
        function closePackagesModal() {
            packagesModal.classList.remove('active');
            packagesModal.setAttribute('aria-hidden', 'true');
            // Reset form
            document.getElementById('newPackageName').value = '';
            document.getElementById('newPackagePrice').value = '';
            document.getElementById('newPackageDuration').value = '';
        }

        // ==================== LOAD & SAVE DATA ====================
        
        function loadData() {
            console.log(' Memuat data admin...');
            
            // Coba load produk dari localStorage
            const savedProducts = localStorage.getItem('admin_products');
            if (savedProducts) {
                try {
                    products = JSON.parse(savedProducts);
                    console.log(` Produk dimuat dari localStorage: ${products.length}`);
                } catch (e) {
                    console.error('Error parsing products:', e);
                    products = [];
                }
            }
            
            // Jika tidak ada produk di localStorage, load dari file
            if (products.length === 0) {
                console.log(' Tidak ada produk di localStorage, memuat dari file...');
                products = loadProductsFromAllSources();
                
                if (products.length > 0) {
                    saveProducts();
                    console.log(` ${products.length} produk dimuat dari file dan disimpan ke localStorage`);
                } else {
                    // Fallback ke data default dengan paket
                    console.log(' Tidak ada produk dari file, menggunakan data default');
                    products = [
                        {
                            id: 1,
                            name: "Netflix Premium",
                            category: "Streaming",
                            price: 28000,
                            originalPrice: 49000,
                            image: "../image/netflix.png",
                            stock: 10,
                            status: "active",
                            isFlashSale: true,
                            isPopular: true,
                            pageUrl: "../pages/product.html?product=Netflix",
                            description: "Netflix Premium dengan berbagai pilihan paket",
                            packages: [
                                { name: "Netflix Sharing 1P1U", price: 28000, duration: "1 BULAN" },
                                { name: "Netflix Sharing 1P2U", price: 22000, duration: "1 BULAN" },
                                { name: "Netflix Semi Private", price: 35000, duration: "1 BULAN" }
                            ]
                        },
                        {
                            id: 2,
                            name: "Spotify Premium",
                            category: "Musik",
                            price: 23000,
                            originalPrice: 75000,
                            image: "../image/spotify.png",
                            stock: 5,
                            status: "active",
                            isFlashSale: false,
                            isPopular: true,
                            pageUrl: "../pages/product.html?product=Spotify",
                            description: "Spotify Premium tanpa iklan",
                            packages: [
                                { name: "Spotify Indplan 1 Bulan", price: 23000, duration: "1 BULAN" }
                            ]
                        },
                        {
                            id: 3,
                            name: "Canva Pro",
                            category: "Editing",
                            price: 5500,
                            originalPrice: 10000,
                            image: "../image/canva.png",
                            stock: 0,
                            status: "sold-out",
                            isFlashSale: false,
                            isPopular: true,
                            pageUrl: "../pages/product.html?product=Canva",
                            description: "Canva Pro dengan semua fitur",
                            packages: [
                                { name: "Canva 1 Bulan", price: 5500, duration: "1 BULAN" },
                                { name: "Canva 1 Tahun", price: 10000, duration: "1 TAHUN" },
                                { name: "Canva Lifetime", price: 18500, duration: "LIFETIME" }
                            ]
                        }
                    ];
                    saveProducts();
                }
            }
            
            // Load kategori
            const savedCategories = localStorage.getItem('admin_categories');
            if (savedCategories) {
                try {
                    categories = JSON.parse(savedCategories);
                } catch (e) {
                    console.error('Error parsing categories:', e);
                    categories = [];
                }
            }
            
            // Jika tidak ada kategori di localStorage, buat dari produk
            if (categories.length === 0) {
                categories = loadCategoriesFromProducts(products);
                saveCategories();
            }
            
            // Load data lainnya
            const savedBanners = localStorage.getItem('admin_banners');
            if (savedBanners) {
                try {
                    banners = JSON.parse(savedBanners);
                } catch (e) {
                    console.error('Error parsing banners:', e);
                    banners = [];
                }
            }
            
            const savedImages = localStorage.getItem('admin_images');
            if (savedImages) {
                try {
                    images = JSON.parse(savedImages);
                } catch (e) {
                    console.error('Error parsing images:', e);
                    images = [];
                }
            }
            
            const savedOrders = localStorage.getItem('admin_orders');
            if (savedOrders) {
                try {
                    orders = JSON.parse(savedOrders);
                } catch (e) {
                    console.error('Error parsing orders:', e);
                    orders = [];
                }
            }

            // Inisialisasi data default jika kosong
            if (banners.length === 0) {
                banners = [
                    { id: 1, title: "Flash Sale", image: "image/baner1.jpg", url: "#" },
                    { id: 2, title: "Produk Terbaru", image: "image/baner2.jpg", url: "#" },
                    { id: 3, title: "Promo Spesial", image: "image/baner3.jpg", url: "#" }
                ];
                saveBanners();
            }

            if (images.length === 0) {
                images = [
                    { id: 1, name: "netflix.jpg", url: "../image/netflix.png", type: "product" },
                    { id: 2, name: "spotify.jpg", url: "../image/spotify.png", type: "product" },
                    { id: 3, name: "canva.jpg", url: "../image/canva.png", type: "product" }
                ];
                saveImages();
            }

            if (orders.length === 0) {
                orders = [
                    { id: "ORD001", product: "Netflix Premium", customer: "081234567890", total: 28000, status: "completed", date: "2025-01-15" },
                    { id: "ORD002", product: "Spotify Premium", customer: "081987654321", total: 23000, status: "pending", date: "2025-01-16" }
                ];
                saveOrders();
            }

            updateStats();
            loadDashboardProducts();
            updateMainSiteProducts();
        }

        function saveProducts() {
            try {
                localStorage.setItem('admin_products', JSON.stringify(products));
                updateMainSiteProducts();
                console.log(' Produk disimpan ke localStorage');
            } catch (e) {
                console.error('Error saving products:', e);
                showNotification('Gagal menyimpan produk', 'error');
            }
        }

        function saveCategories() {
            try {
                localStorage.setItem('admin_categories', JSON.stringify(categories));
            } catch (e) {
                console.error('Error saving categories:', e);
                showNotification('Gagal menyimpan kategori', 'error');
            }
        }

        function saveBanners() {
            try {
                localStorage.setItem('admin_banners', JSON.stringify(banners));
            } catch (e) {
                console.error('Error saving banners:', e);
                showNotification('Gagal menyimpan banner', 'error');
            }
        }

        function saveImages() {
            try {
                localStorage.setItem('admin_images', JSON.stringify(images));
            } catch (e) {
                console.error('Error saving images:', e);
                showNotification('Gagal menyimpan gambar', 'error');
            }
        }

        function saveOrders() {
            try {
                localStorage.setItem('admin_orders', JSON.stringify(orders));
            } catch (e) {
                console.error('Error saving orders:', e);
                showNotification('Gagal menyimpan pesanan', 'error');
            }
        }

        function updateMainSiteProducts() {
            try {
                // Update produk di produk.js jika ada
                if (typeof semuaProduk !== 'undefined') {
                    products.forEach(adminProduct => {
                        const productKey = Object.keys(semuaProduk).find(key => 
                            semuaProduk[key].name === adminProduct.name
                        );
                        
                        if (productKey && adminProduct.packages && adminProduct.packages.length > 0) {
                            // Update harga paket di produk.js
                            semuaProduk[productKey].packages = adminProduct.packages;
                        }
                    });
                }
                
                // Update data untuk halaman utama
                const productData = {
                    products: products.map(p => ({
                        id: p.id,
                        name: p.name,
                        category: p.category,
                        price: p.price,
                        originalPrice: p.originalPrice || null,
                        image: p.image,
                        discount: p.originalPrice ? Math.round(((p.originalPrice - p.price) / p.originalPrice) * 100) : 0,
                        isPopular: p.isPopular || false,
                        isFlashSale: p.isFlashSale || false,
                        pageUrl: p.pageUrl || "#",
                        stock: p.stock || 0,
                        status: p.status || "active",
                        sold: p.sold || 0,
                        description: p.description || "",
                        packages: p.packages || [] // Sertakan paket di data utama
                    })),
                    categories: categories.map(c => ({ 
                        id: c.id, 
                        name: c.name 
                    }))
                };
                
                localStorage.setItem('productData', JSON.stringify(productData));
                console.log(' Data produk utama diperbarui');
            } catch (e) {
                console.error('Error updating main site products:', e);
            }
        }

        // ==================== FUNGSI UTILITAS ====================
        
        function showNotification(message, type = 'success') {
            notification.className = `notification ${type}`;
            notificationMessage.textContent = message;
            notification.classList.add('active');
            
            notification.setAttribute('aria-label', `${type} notification: ${message}`);
            
            setTimeout(() => {
                notification.classList.remove('active');
            }, 3000);
        }

        function updateStats() {
            try {
                const totalProducts = products.length;
                const activeProducts = products.filter(p => p.status === 'active').length;
                const soldOutProducts = products.filter(p => p.status === 'sold-out').length;
                const totalCategories = categories.length;
                
                document.getElementById('totalProducts').textContent = totalProducts;
                document.getElementById('activeProducts').textContent = activeProducts;
                document.getElementById('soldOutProducts').textContent = soldOutProducts;
                document.getElementById('totalCategories').textContent = totalCategories;
            } catch (e) {
                console.error('Error updating stats:', e);
            }
        }

        // ==================== LOAD DATA KE TABLE ====================
        
        function loadDashboardProducts() {
            try {
                const tbody = document.getElementById('productsTableBody');
                tbody.innerHTML = '';
                
                products.slice(0, 5).forEach(product => {
                    const hasPackages = product.packages && product.packages.length > 0;
                    const packagesText = hasPackages ? `${product.packages.length} paket` : 'Tidak ada paket';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div class="product-info">
                                <img src="${product.image}" alt="${product.name}" class="product-image" loading="lazy">
                                <div>
                                    <div class="product-name">${product.name}</div>
                                    <span class="product-category">${product.category}</span>
                                    <div style="font-size: 0.75rem; color: var(--text-light); margin-top: 0.25rem;">
                                        <i class="fas fa-box"></i> ${packagesText}
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>${product.category}</td>
                        <td class="price">Rp ${product.price.toLocaleString('id-ID')}</td>
                        <td>${product.stock}</td>
                        <td>
                            <span class="status-badge ${product.status === 'active' ? 'status-active' : 'status-sold-out'}">
                                ${product.status === 'active' ? 'Aktif' : 'Habis'}
                            </span>
                        </td>
                        <td>
                            <div class="actions">
                                <button class="btn-icon btn-package" onclick="openManagePackages(${product.id})" aria-label="Kelola paket ${product.name}" title="Kelola Paket">
                                    <i class="fas fa-boxes"></i>
                                </button>
                                <button class="btn-icon btn-edit" onclick="editProduct(${product.id})" aria-label="Edit ${product.name}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-icon btn-delete" onclick="deleteProduct(${product.id})" aria-label="Hapus ${product.name}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (e) {
                console.error('Error loading dashboard products:', e);
            }
        }

        function loadProductsManagement() {
            try {
                const tbody = document.getElementById('productsListBody');
                tbody.innerHTML = '';
                
                products.forEach(product => {
                    const hasPackages = product.packages && product.packages.length > 0;
                    const packagesText = hasPackages ? `${product.packages.length} paket` : 'Tidak ada paket';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div class="product-info">
                                <img src="${product.image}" alt="${product.name}" class="product-image" loading="lazy">
                                <div>
                                    <div class="product-name">${product.name}</div>
                                    <div style="font-size: 0.85rem; color: var(--text-light);">${product.description || ''}</div>
                                    <div style="font-size: 0.75rem; color: var(--text-light); margin-top: 0.25rem;">
                                        <i class="fas fa-box"></i> ${packagesText}
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>${product.category}</td>
                        <td class="price">Rp ${product.price.toLocaleString('id-ID')}</td>
                        <td>${product.stock}</td>
                        <td>
                            <span class="status-badge ${product.status === 'active' ? 'status-active' : 'status-sold-out'}">
                                ${product.status === 'active' ? 'Aktif' : 'Habis'}
                            </span>
                        </td>
                        <td>
                            <div class="actions">
                                <button class="btn-icon btn-package" onclick="openManagePackages(${product.id})" aria-label="Kelola paket ${product.name}" title="Kelola Paket">
                                    <i class="fas fa-boxes"></i>
                                </button>
                                <button class="btn-icon btn-edit" onclick="editProduct(${product.id})" aria-label="Edit ${product.name}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-icon btn-delete" onclick="deleteProduct(${product.id})" aria-label="Hapus ${product.name}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (e) {
                console.error('Error loading products management:', e);
            }
        }

        function loadCategories() {
            try {
                const tbody = document.getElementById('categoriesListBody');
                tbody.innerHTML = '';
                
                // Update product counts
                categories.forEach(category => {
                    category.count = products.filter(p => p.category === category.name).length;
                });
                saveCategories();
                
                categories.forEach(category => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${category.name}</td>
                        <td>${category.count} produk</td>
                        <td>
                            <div class="actions">
                                <button class="btn-icon btn-edit" onclick="editCategory(${category.id})" aria-label="Edit ${category.name}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-icon btn-delete" onclick="deleteCategory(${category.id})" aria-label="Hapus ${category.name}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                updateCategoryDropdown();
            } catch (e) {
                console.error('Error loading categories:', e);
            }
        }

        function loadImages() {
            try {
                const container = document.getElementById('imageManager');
                container.innerHTML = '';
                
                images.forEach(image => {
                    const item = document.createElement('div');
                    item.className = 'image-item';
                    item.innerHTML = `
                        <img src="${image.url}" alt="${image.name}" loading="lazy">
                        <div class="image-actions">
                            <button class="btn-icon btn-edit" onclick="useImage('${image.url}')" aria-label="Gunakan gambar ${image.name}">
                                <i class="fas fa-link"></i>
                            </button>
                            <button class="btn-icon btn-delete" onclick="deleteImage(${image.id})" aria-label="Hapus gambar ${image.name}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    container.appendChild(item);
                });
            } catch (e) {
                console.error('Error loading images:', e);
            }
        }

        function loadBanners() {
            try {
                const container = document.getElementById('bannerGrid');
                container.innerHTML = '';
                
                banners.forEach(banner => {
                    const item = document.createElement('div');
                    item.className = 'banner-item';
                    item.innerHTML = `
                        <img src="${banner.image}" alt="${banner.title}" class="banner-image" loading="lazy">
                        <div class="banner-info">
                            <div class="banner-name">${banner.title}</div>
                            <div style="font-size: 0.85rem; color: var(--text-light); margin-bottom: 0.5rem;">${banner.url}</div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn-icon btn-edit" style="font-size: 0.8rem;" onclick="editBanner(${banner.id})" aria-label="Edit banner ${banner.title}">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn-icon btn-delete" style="font-size: 0.8rem;" onclick="deleteBanner(${banner.id})" aria-label="Hapus banner ${banner.title}">
                                    <i class="fas fa-trash"></i> Hapus
                                </button>
                            </div>
                        </div>
                    `;
                    container.appendChild(item);
                });
            } catch (e) {
                console.error('Error loading banners:', e);
            }
        }

        function loadStockManagement() {
            try {
                const tbody = document.getElementById('stockListBody');
                tbody.innerHTML = '';
                
                products.forEach(product => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div class="product-info">
                                <img src="${product.image}" alt="${product.name}" class="product-image" loading="lazy">
                                <div>
                                    <div class="product-name">${product.name}</div>
                                    <span class="product-category">${product.category}</span>
                                </div>
                            </div>
                        </td>
                        <td>${product.stock}</td>
                        <td>
                            <span class="status-badge ${product.status === 'active' ? 'status-active' : 'status-sold-out'}">
                                ${product.status === 'active' ? 'Aktif' : 'Habis'}
                            </span>
                        </td>
                        <td>
                            <input type="number" class="form-control" style="width: 100px;" 
                                   value="${product.stock}" min="0" 
                                   onchange="updateStock(${product.id}, this.value)"
                                   aria-label="Update stok ${product.name}">
                        </td>
                        <td>
                            <button class="btn btn-danger" onclick="setSoldOut(${product.id})" ${product.stock > 0 ? '' : 'disabled'} aria-label="Set habis ${product.name}">
                                <i class="fas fa-times"></i> Set Habis
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (e) {
                console.error('Error loading stock management:', e);
            }
        }

        function loadOrders() {
            try {
                const tbody = document.getElementById('ordersListBody');
                tbody.innerHTML = '';
                
                orders.forEach(order => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${order.id}</td>
                        <td>${order.product}</td>
                        <td>${order.customer}</td>
                        <td class="price">Rp ${order.total.toLocaleString('id-ID')}</td>
                        <td>
                            <span class="status-badge ${order.status === 'completed' ? 'status-active' : 'status-warning'}">
                                ${order.status === 'completed' ? 'Selesai' : 'Pending'}
                            </span>
                        </td>
                        <td>${order.date}</td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (e) {
                console.error('Error loading orders:', e);
            }
        }

        // ==================== CRUD OPERATIONS ====================
        
        function addProduct(product) {
            try {
                const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
                product.id = newId;
                product.status = product.stock > 0 ? 'active' : 'sold-out';
                product.packages = product.packages || []; // Inisialisasi array paket
                products.push(product);
                saveProducts();
                showNotification('Produk berhasil ditambahkan');
                loadProductsManagement();
                loadDashboardProducts();
                updateStats();
            } catch (e) {
                console.error('Error adding product:', e);
                showNotification('Gagal menambahkan produk', 'error');
            }
        }

        function editProduct(id) {
            try {
                const product = products.find(p => p.id === id);
                if (!product) return;
                
                document.getElementById('productName').value = product.name;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productOriginalPrice').value = product.originalPrice || '';
                document.getElementById('productStock').value = product.stock;
                document.getElementById('productUrl').value = product.pageUrl || '';
                document.getElementById('productDescription').value = product.description || '';
                document.getElementById('productFlashSale').value = product.isFlashSale ? 'yes' : 'no';
                document.getElementById('productPopular').value = product.isPopular ? 'yes' : 'no';
                document.getElementById('productId').value = product.id;
                document.getElementById('productImagePreview').src = product.image;
                
                const categorySelect = document.getElementById('productCategory');
                categorySelect.value = product.category;
                
                document.querySelector('#productModal .modal-title').textContent = 'Edit Produk';
                document.getElementById('productModalTitle').textContent = 'Edit Produk';
                
                productModal.classList.add('active');
                productModal.setAttribute('aria-hidden', 'false');
            } catch (e) {
                console.error('Error editing product:', e);
                showNotification('Gagal mengedit produk', 'error');
            }
        }

        function updateProduct(id, updatedData) {
            try {
                const index = products.findIndex(p => p.id === id);
                if (index === -1) return;
                
                updatedData.status = updatedData.stock > 0 ? 'active' : 'sold-out';
                
                // Jangan overwrite paket yang sudah ada
                if (!updatedData.packages) {
                    updatedData.packages = products[index].packages || [];
                }
                
                products[index] = { ...products[index], ...updatedData };
                saveProducts();
                showNotification('Produk berhasil diperbarui');
                loadProductsManagement();
                loadDashboardProducts();
                updateStats();
            } catch (e) {
                console.error('Error updating product:', e);
                showNotification('Gagal memperbarui produk', 'error');
            }
        }

        function deleteProduct(id) {
            if (confirm('Apakah Anda yakin ingin menghapus produk ini?')) {
                try {
                    products = products.filter(p => p.id !== id);
                    saveProducts();
                    showNotification('Produk berhasil dihapus');
                    loadProductsManagement();
                    loadDashboardProducts();
                    updateStats();
                } catch (e) {
                    console.error('Error deleting product:', e);
                    showNotification('Gagal menghapus produk', 'error');
                }
            }
        }

        function addCategory(name) {
            try {
                const newId = categories.length > 0 ? Math.max(...categories.map(c => c.id)) + 1 : 1;
                categories.push({ id: newId, name, count: 0 });
                saveCategories();
                showNotification('Kategori berhasil ditambahkan');
                loadCategories();
                updateStats();
            } catch (e) {
                console.error('Error adding category:', e);
                showNotification('Gagal menambahkan kategori', 'error');
            }
        }

        function editCategory(id) {
            try {
                const category = categories.find(c => c.id === id);
                if (!category) return;
                
                document.getElementById('categoryName').value = category.name;
                document.getElementById('categoryId').value = category.id;
                document.querySelector('#categoryModal .modal-title').textContent = 'Edit Kategori';
                document.getElementById('categoryModalTitle').textContent = 'Edit Kategori';
                categoryModal.classList.add('active');
                categoryModal.setAttribute('aria-hidden', 'false');
            } catch (e) {
                console.error('Error editing category:', e);
                showNotification('Gagal mengedit kategori', 'error');
            }
        }

        function updateCategory(id, name) {
            try {
                const index = categories.findIndex(c => c.id === id);
                if (index === -1) return;
                
                const oldName = categories[index].name;
                categories[index].name = name;
                
                products.forEach(product => {
                    if (product.category === oldName) {
                        product.category = name;
                    }
                });
                
                saveCategories();
                saveProducts();
                showNotification('Kategori berhasil diperbarui');
                loadCategories();
                loadProductsManagement();
            } catch (e) {
                console.error('Error updating category:', e);
                showNotification('Gagal memperbarui kategori', 'error');
            }
        }

        function deleteCategory(id) {
            try {
                const category = categories.find(c => c.id === id);
                if (!category) return;
                
                const productsWithCategory = products.filter(p => p.category === category.name);
                
                if (productsWithCategory.length > 0) {
                    if (!confirm(`Kategori ini digunakan oleh ${productsWithCategory.length} produk. Tetap hapus?`)) {
                        return;
                    }
                }
                
                categories = categories.filter(c => c.id !== id);
                saveCategories();
                showNotification('Kategori berhasil dihapus');
                loadCategories();
                updateStats();
            } catch (e) {
                console.error('Error deleting category:', e);
                showNotification('Gagal menghapus kategori', 'error');
            }
        }

        function addBanner(banner) {
            try {
                const newId = banners.length > 0 ? Math.max(...banners.map(b => b.id)) + 1 : 1;
                banner.id = newId;
                banners.push(banner);
                saveBanners();
                showNotification('Banner berhasil ditambahkan');
                loadBanners();
            } catch (e) {
                console.error('Error adding banner:', e);
                showNotification('Gagal menambahkan banner', 'error');
            }
        }

        function editBanner(id) {
            try {
                const banner = banners.find(b => b.id === id);
                if (!banner) return;
                
                document.getElementById('bannerTitle').value = banner.title;
                document.getElementById('bannerUrl').value = banner.url;
                document.getElementById('bannerId').value = banner.id;
                document.getElementById('bannerImagePreview').src = banner.image;
                document.querySelector('#bannerModal .modal-title').textContent = 'Edit Banner';
                document.getElementById('bannerModalTitle').textContent = 'Edit Banner';
                bannerModal.classList.add('active');
                bannerModal.setAttribute('aria-hidden', 'false');
            } catch (e) {
                console.error('Error editing banner:', e);
                showNotification('Gagal mengedit banner', 'error');
            }
        }

        function updateBanner(id, updatedData) {
            try {
                const index = banners.findIndex(b => b.id === id);
                if (index === -1) return;
                
                banners[index] = { ...banners[index], ...updatedData };
                saveBanners();
                showNotification('Banner berhasil diperbarui');
                loadBanners();
            } catch (e) {
                console.error('Error updating banner:', e);
                showNotification('Gagal memperbarui banner', 'error');
            }
        }

        function deleteBanner(id) {
            if (confirm('Apakah Anda yakin ingin menghapus banner ini?')) {
                try {
                    banners = banners.filter(b => b.id !== id);
                    saveBanners();
                    showNotification('Banner berhasil dihapus');
                    loadBanners();
                } catch (e) {
                    console.error('Error deleting banner:', e);
                    showNotification('Gagal menghapus banner', 'error');
                }
            }
        }

        function uploadImage(file) {
            if (!file.type.match('image.*')) {
                showNotification('File harus berupa gambar', 'error');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                showNotification('Ukuran gambar maksimal 5MB', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const newId = images.length > 0 ? Math.max(...images.map(i => i.id)) + 1 : 1;
                    const newImage = {
                        id: newId,
                        name: file.name,
                        url: e.target.result,
                        type: 'product'
                    };
                    images.push(newImage);
                    saveImages();
                    showNotification('Gambar berhasil diupload');
                    loadImages();
                } catch (e) {
                    console.error('Error uploading image:', e);
                    showNotification('Gagal mengupload gambar', 'error');
                }
            };
            reader.onerror = function() {
                showNotification('Gagal membaca file gambar', 'error');
            };
            reader.readAsDataURL(file);
        }

        function useImage(url) {
            navigator.clipboard.writeText(url).then(() => {
                showNotification('URL gambar disalin ke clipboard');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                showNotification('Gagal menyalin URL', 'error');
            });
        }

        function deleteImage(id) {
            if (confirm('Apakah Anda yakin ingin menghapus gambar ini?')) {
                try {
                    images = images.filter(i => i.id !== id);
                    saveImages();
                    showNotification('Gambar berhasil dihapus');
                    loadImages();
                } catch (e) {
                    console.error('Error deleting image:', e);
                    showNotification('Gagal menghapus gambar', 'error');
                }
            }
        }

        function updateStock(productId, newStock) {
            try {
                const product = products.find(p => p.id === productId);
                if (!product) return;
                
                newStock = parseInt(newStock);
                if (isNaN(newStock)) {
                    showNotification('Stok harus berupa angka', 'error');
                    return;
                }
                
                product.stock = newStock;
                
                if (newStock === 0) {
                    const autoRedirect = document.getElementById('autoRedirect').value;
                    if (autoRedirect === 'yes') {
                        product.status = 'sold-out';
                        showNotification(`Produk ${product.name} habis. Akan redirect ke sold.html`);
                    }
                } else if (newStock > 0 && product.status === 'sold-out') {
                    product.status = 'active';
                }
                
                saveProducts();
                showNotification('Stok berhasil diperbarui');
                loadStockManagement();
                loadProductsManagement();
                loadDashboardProducts();
                updateStats();
            } catch (e) {
                console.error('Error updating stock:', e);
                showNotification('Gagal memperbarui stok', 'error');
            }
        }

        function setSoldOut(productId) {
            try {
                const product = products.find(p => p.id === productId);
                if (!product) return;
                
                product.stock = 0;
                product.status = 'sold-out';
                saveProducts();
                showNotification('Produk diatur sebagai habis terjual');
                loadStockManagement();
                loadProductsManagement();
                loadDashboardProducts();
                updateStats();
            } catch (e) {
                console.error('Error setting sold out:', e);
                showNotification('Gagal mengatur produk sebagai habis', 'error');
            }
        }

        function updateCategoryDropdown() {
            try {
                const select = document.getElementById('productCategory');
                select.innerHTML = '<option value="">Pilih Kategori</option>';
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.name;
                    option.textContent = category.name;
                    select.appendChild(option);
                });
            } catch (e) {
                console.error('Error updating category dropdown:', e);
            }
        }

        // ==================== SYNC FUNCTIONS ====================
        
        function resyncProductsFromFiles() {
            if (confirm('Sync ulang produk dari file? Produk baru dari file akan ditambahkan, produk yang sudah ada tidak akan diubah.')) {
                const loadedProducts = loadProductsFromAllSources();
                let newCount = 0;
                let updatedCount = 0;
                
                loadedProducts.forEach(newProduct => {
                    const existingIndex = products.findIndex(p => 
                        p.name.toLowerCase() === newProduct.name.toLowerCase()
                    );
                    
                    if (existingIndex === -1) {
                        // Produk baru, tambahkan
                        const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
                        newProduct.id = newId;
                        products.push(newProduct);
                        newCount++;
                    } else {
                        // Produk sudah ada, update data yang kosong
                        const existingProduct = products[existingIndex];
                        let updated = false;
                        
                        if (!existingProduct.description && newProduct.description) {
                            existingProduct.description = newProduct.description;
                            updated = true;
                        }
                        
                        if (!existingProduct.image || existingProduct.image.includes('placeholder')) {
                            existingProduct.image = newProduct.image;
                            updated = true;
                        }
                        
                        if (existingProduct.price === 0 && newProduct.price > 0) {
                            existingProduct.price = newProduct.price;
                            updated = true;
                        }
                        
                        // Update paket jika produk tidak punya paket
                        if ((!existingProduct.packages || existingProduct.packages.length === 0) && 
                            newProduct.packages && newProduct.packages.length > 0) {
                            existingProduct.packages = newProduct.packages;
                            updated = true;
                        }
                        
                        if (updated) updatedCount++;
                    }
                });
                
                if (newCount > 0 || updatedCount > 0) {
                    saveProducts();
                    showNotification(`${newCount} produk baru ditambahkan, ${updatedCount} produk diperbarui`);
                    loadProductsManagement();
                    loadDashboardProducts();
                    updateStats();
                } else {
                    showNotification('Tidak ada perubahan dari file');
                }
            }
        }

        // ==================== EVENT LISTENERS ====================
        
        function setupModalCloseOnOutsideClick(modal, closeCallback) {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeCallback();
                }
            });
        }

        function setupModalCloseWithEscape(closeCallback) {
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeCallback();
                }
            });
        }

        function init() {
            console.log(' Admin panel diinisialisasi...');
            
            loadData();
            
            mobileMenuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
                const isExpanded = sidebar.classList.contains('active');
                mobileMenuToggle.setAttribute('aria-expanded', isExpanded);
            });
            
            document.addEventListener('click', (e) => {
                if (window.innerWidth <= 992 && 
                    !sidebar.contains(e.target) && 
                    !mobileMenuToggle.contains(e.target) &&
                    sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                    mobileMenuToggle.setAttribute('aria-expanded', 'false');
                }
            });
            
            menuItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    menuItems.forEach(i => i.classList.remove('active'));
                    pageContents.forEach(c => c.style.display = 'none');
                    
                    item.classList.add('active');
                    
                    const page = item.getAttribute('data-page');
                    pageTitle.textContent = item.querySelector('span').textContent;
                    
                    const targetPage = document.getElementById(`${page}Content`);
                    if (targetPage) {
                        targetPage.style.display = 'block';
                    }
                    
                    switch(page) {
                        case 'products':
                            loadProductsManagement();
                            break;
                        case 'categories':
                            loadCategories();
                            break;
                        case 'images':
                            loadImages();
                            break;
                        case 'banners':
                            loadBanners();
                            break;
                        case 'stock':
                            loadStockManagement();
                            break;
                        case 'orders':
                            loadOrders();
                            break;
                    }
                    
                    if (window.innerWidth <= 992) {
                        sidebar.classList.remove('active');
                        mobileMenuToggle.setAttribute('aria-expanded', 'false');
                    }
                });
            });
            
            syncProductsBtn.addEventListener('click', resyncProductsFromFiles);
            
            // Product Modal
            document.getElementById('addProductBtn').addEventListener('click', () => {
                document.getElementById('productForm').reset();
                document.getElementById('productId').value = '';
                document.getElementById('productImagePreview').src = 'https://via.placeholder.com/100/1E40AF/FFFFFF?text=Produk';
                document.querySelector('#productModal .modal-title').textContent = 'Tambah Produk Baru';
                document.getElementById('productModalTitle').textContent = 'Tambah Produk Baru';
                updateCategoryDropdown();
                productModal.classList.add('active');
                productModal.setAttribute('aria-hidden', 'false');
            });
            
            document.getElementById('productForm').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const productData = {
                    name: document.getElementById('productName').value,
                    category: document.getElementById('productCategory').value,
                    price: parseInt(document.getElementById('productPrice').value),
                    originalPrice: parseInt(document.getElementById('productOriginalPrice').value) || null,
                    stock: parseInt(document.getElementById('productStock').value),
                    image: document.getElementById('productImagePreview').src,
                    pageUrl: document.getElementById('productUrl').value,
                    description: document.getElementById('productDescription').value,
                    isFlashSale: document.getElementById('productFlashSale').value === 'yes',
                    isPopular: document.getElementById('productPopular').value === 'yes',
                    packages: [] // Inisialisasi dengan array kosong
                };
                
                const productId = document.getElementById('productId').value;
                
                if (productId) {
                    updateProduct(parseInt(productId), productData);
                } else {
                    addProduct(productData);
                }
                
                productModal.classList.remove('active');
                productModal.setAttribute('aria-hidden', 'true');
            });
            
            document.getElementById('productImage').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    uploadImage(file);
                }
            });
            
            const closeProductModal = () => {
                productModal.classList.remove('active');
                productModal.setAttribute('aria-hidden', 'true');
            };
            
            document.getElementById('closeProductModal').addEventListener('click', closeProductModal);
            document.getElementById('cancelProduct').addEventListener('click', closeProductModal);
            setupModalCloseOnOutsideClick(productModal, closeProductModal);
            setupModalCloseWithEscape(closeProductModal);
            
            // Packages Modal
            document.getElementById('addPackageBtn').addEventListener('click', () => {
                const name = document.getElementById('newPackageName').value.trim();
                const price = document.getElementById('newPackagePrice').value;
                const duration = document.getElementById('newPackageDuration').value.trim();
                
                if (!name || !price || !duration) {
                    showNotification('Harap isi semua field', 'error');
                    return;
                }
                
                addPackageToModal(name, price, duration);
                
                // Reset form
                document.getElementById('newPackageName').value = '';
                document.getElementById('newPackagePrice').value = '';
                document.getElementById('newPackageDuration').value = '';
            });
            
            document.getElementById('savePackages').addEventListener('click', savePackages);
            document.getElementById('cancelPackages').addEventListener('click', closePackagesModal);
            document.getElementById('closePackagesModal').addEventListener('click', closePackagesModal);
            setupModalCloseOnOutsideClick(packagesModal, closePackagesModal);
            
            // Category Modal
            document.getElementById('addCategoryBtn').addEventListener('click', () => {
                document.getElementById('categoryForm').reset();
                document.getElementById('categoryId').value = '';
                document.querySelector('#categoryModal .modal-title').textContent = 'Tambah Kategori Baru';
                document.getElementById('categoryModalTitle').textContent = 'Tambah Kategori Baru';
                categoryModal.classList.add('active');
                categoryModal.setAttribute('aria-hidden', 'false');
            });
            
            document.getElementById('categoryForm').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const name = document.getElementById('categoryName').value;
                const categoryId = document.getElementById('categoryId').value;
                
                if (categoryId) {
                    updateCategory(parseInt(categoryId), name);
                } else {
                    addCategory(name);
                }
                
                categoryModal.classList.remove('active');
                categoryModal.setAttribute('aria-hidden', 'true');
            });
            
            const closeCategoryModal = () => {
                categoryModal.classList.remove('active');
                categoryModal.setAttribute('aria-hidden', 'true');
            };
            
            document.getElementById('closeCategoryModal').addEventListener('click', closeCategoryModal);
            document.getElementById('cancelCategory').addEventListener('click', closeCategoryModal);
            setupModalCloseOnOutsideClick(categoryModal, closeCategoryModal);
            
            // Banner Modal
            document.getElementById('addBannerBtn').addEventListener('click', () => {
                document.getElementById('bannerForm').reset();
                document.getElementById('bannerId').value = '';
                document.getElementById('bannerImagePreview').src = 'https://via.placeholder.com/300x100/0A1931/FFFFFF?text=Banner';
                document.querySelector('#bannerModal .modal-title').textContent = 'Tambah Banner Baru';
                document.getElementById('bannerModalTitle').textContent = 'Tambah Banner Baru';
                bannerModal.classList.add('active');
                bannerModal.setAttribute('aria-hidden', 'false');
            });
            
            document.getElementById('bannerForm').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const bannerData = {
                    title: document.getElementById('bannerTitle').value,
                    image: document.getElementById('bannerImagePreview').src,
                    url: document.getElementById('bannerUrl').value
                };
                
                const bannerId = document.getElementById('bannerId').value;
                
                if (bannerId) {
                    updateBanner(parseInt(bannerId), bannerData);
                } else {
                    addBanner(bannerData);
                }
                
                bannerModal.classList.remove('active');
                bannerModal.setAttribute('aria-hidden', 'true');
            });
            
            document.getElementById('bannerImage').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('bannerImagePreview').src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            const closeBannerModal = () => {
                bannerModal.classList.remove('active');
                bannerModal.setAttribute('aria-hidden', 'true');
            };
            
            document.getElementById('closeBannerModal').addEventListener('click', closeBannerModal);
            document.getElementById('cancelBanner').addEventListener('click', closeBannerModal);
            setupModalCloseOnOutsideClick(bannerModal, closeBannerModal);
            
            // Image Upload
            document.getElementById('uploadImage').addEventListener('change', (e) => {
                const files = e.target.files;
                for (let file of files) {
                    uploadImage(file);
                }
                e.target.value = '';
            });
            
            // Save Settings
            document.getElementById('saveSettings').addEventListener('click', () => {
                try {
                    const settings = {
                        storeName: document.getElementById('storeName').value,
                        adminWhatsApp: document.getElementById('adminWhatsApp').value,
                        adminEmail: document.getElementById('adminEmail').value,
                        autoRedirect: document.getElementById('autoRedirect').value
                    };
                    localStorage.setItem('admin_settings', JSON.stringify(settings));
                    showNotification('Pengaturan berhasil disimpan');
                } catch (e) {
                    console.error('Error saving settings:', e);
                    showNotification('Gagal menyimpan pengaturan', 'error');
                }
            });
            
            const savedSettings = localStorage.getItem('admin_settings');
            if (savedSettings) {
                try {
                    const settings = JSON.parse(savedSettings);
                    document.getElementById('storeName').value = settings.storeName || 'GIVASTORE.ID';
                    document.getElementById('adminWhatsApp').value = settings.adminWhatsApp || '6285189139082';
                    document.getElementById('adminEmail').value = settings.adminEmail || 'xyzopedia@gmail.com';
                    document.getElementById('autoRedirect').value = settings.autoRedirect || 'yes';
                } catch (e) {
                    console.error('Error loading settings:', e);
                }
            }
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', () => {
                if (confirm('Apakah Anda yakin ingin logout?')) {
                    window.location.href = 'index.html';
                }
            });
            
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    if (window.innerWidth > 992) {
                        sidebar.classList.remove('active');
                        mobileMenuToggle.setAttribute('aria-expanded', 'false');
                    }
                }, 250);
            });
            
            console.log(' Admin panel siap digunakan');
        }

        // ==================== GLOBAL FUNCTIONS ====================
        
        window.editProduct = editProduct;
        window.deleteProduct = deleteProduct;
        window.editCategory = editCategory;
        window.deleteCategory = deleteCategory;
        window.editBanner = editBanner;
        window.deleteBanner = deleteBanner;
        window.useImage = useImage;
        window.deleteImage = deleteImage;
        window.updateStock = updateStock;
        window.setSoldOut = setSoldOut;
        window.openManagePackages = openManagePackages;
        window.removePackage = removePackage;
        window.resyncProductsFromFiles = resyncProductsFromFiles;

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>