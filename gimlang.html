<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin Panel - GIVASTORE.ID</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="image/icon.jpg" type="image/jpeg">
    
    <style>
        /* CSS Reset untuk kompatibilitas */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
        }

        /* Import Font Pricedown */
        @font-face {
            font-family: 'Pricedown';
            src: url('pricedown bl.woff2') format('woff2'),
                 url('pricedown bl.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        /* Color Variables */
        :root {
            --primary: #0A1931;
            --primary-alt: #152C5B;
            --accent: #1E40AF;
            --secondary: #3B82F6;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --info: #3B82F6;
            --dark: #1F2937;
            --light: #F9FAFB;
            --sidebar: #0A1931;
            --sidebar-hover: #152C5B;
            --text-dark: #111827;
            --text: #374151;
            --text-light: #6B7280;
            --border: #E5E7EB;
            --radius: 8px;
            --radius-lg: 12px;
            --shadow: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
        }

        html {
            height: 100%;
            font-size: 16px;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--light);
            color: var(--text);
            line-height: 1.5;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Admin Layout */
        .admin-container {
            display: flex;
            min-height: 100vh;
            position: relative;
        }

        /* Sidebar */
        .admin-sidebar {
            width: 260px;
            min-width: 260px;
            background: var(--sidebar);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 1000;
            -webkit-overflow-scrolling: touch;
        }

        .sidebar-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: sticky;
            top: 0;
            background: var(--sidebar);
            z-index: 10;
        }

        .brand-text {
            font-family: 'Pricedown', 'Poppins', sans-serif;
            font-size: 1.8rem;
            color: white;
            letter-spacing: 1px;
            line-height: 1.2;
        }

        .brand-subtitle {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 0.25rem;
        }

        .sidebar-menu {
            padding: 1rem 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.85rem 1.5rem;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .menu-item:hover,
        .menu-item.active {
            background: var(--sidebar-hover);
            color: white;
            border-left-color: var(--accent);
        }

        .menu-item i {
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        .menu-item span {
            font-size: 0.9rem;
            font-weight: 500;
            flex: 1;
        }

        .sidebar-footer {
            padding: 1.25rem 1.5rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            margin-top: auto;
            position: sticky;
            bottom: 0;
            background: var(--sidebar);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            min-width: 40px;
            border-radius: 50%;
            background: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1rem;
        }

        .user-details h4 {
            font-size: 0.9rem;
            font-weight: 600;
            line-height: 1.3;
        }

        .user-details p {
            font-size: 0.75rem;
            opacity: 0.7;
            line-height: 1.2;
        }

        /* Main Content */
        .admin-main {
            flex: 1;
            margin-left: 260px;
            padding: 1rem;
            transition: margin-left 0.3s ease, padding 0.3s ease;
            width: calc(100% - 260px);
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 1rem;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
            line-height: 1.2;
            flex: 1;
            min-width: 200px;
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        /* Button Styles */
        .btn {
            padding: 0.6rem 1.2rem;
            border-radius: var(--radius);
            border: none;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            line-height: 1.2;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
            border: 1px solid var(--accent);
        }

        .btn-primary:hover,
        .btn-primary:focus {
            background: var(--primary-alt);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.2);
        }

        .btn-success {
            background: var(--success);
            color: white;
            border: 1px solid var(--success);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            border: 1px solid var(--danger);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
        }

        .btn-outline:hover {
            background: var(--light);
            border-color: var(--accent);
        }

        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.25rem;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--border);
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            margin-bottom: 1rem;
        }

        .stat-icon.total { background: rgba(59, 130, 246, 0.1); color: var(--info); }
        .stat-icon.active { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .stat-icon.sold-out { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .stat-icon.categories { background: rgba(245, 158, 11, 0.1); color: var(--warning); }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
            line-height: 1.2;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        /* Table Container */
        .table-container {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        thead {
            background: var(--light);
        }

        th {
            padding: 0.875rem 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-dark);
            border-bottom: 1px solid var(--border);
            white-space: nowrap;
        }

        td {
            padding: 0.875rem 1rem;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }

        .product-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            min-width: 250px;
        }

        .product-image {
            width: 48px;
            height: 48px;
            min-width: 48px;
            border-radius: 8px;
            object-fit: cover;
            background: var(--light);
        }

        .product-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.2rem;
            line-height: 1.3;
            word-break: break-word;
        }

        .product-category {
            font-size: 0.75rem;
            color: var(--text-light);
            background: var(--light);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            display: inline-block;
            border: 1px solid var(--border);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
            white-space: nowrap;
        }

        .status-active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .status-sold-out {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .status-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .price {
            font-weight: 600;
            color: var(--text-dark);
            white-space: nowrap;
        }

        .actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            min-width: 36px;
            border-radius: 6px;
            border: none;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            -webkit-tap-highlight-color: transparent;
        }

        .btn-edit {
            color: var(--info);
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .btn-edit:hover,
        .btn-edit:focus {
            background: var(--info);
            color: white;
            border-color: var(--info);
        }

        .btn-delete {
            color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .btn-delete:hover,
        .btn-delete:focus {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        .btn-package {
            color: var(--warning);
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .btn-package:hover,
        .btn-package:focus {
            background: var(--warning);
            color: white;
            border-color: var(--warning);
        }

        /* ========== PERBAIKAN MODAL DROPDOWN ========== */
        /* Modal Styles - Diperbaiki */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            animation: modalFadeIn 0.3s ease;
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlide 0.3s ease;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            position: relative;
            z-index: 2001; /* PERBAIKAN: Z-index lebih tinggi */
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-dark);
            line-height: 1.3;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .modal-close:hover {
            background: var(--light);
            color: var(--danger);
        }

        .modal-body {
            padding: 1.5rem;
            position: relative;
            z-index: 1;
        }

        /* Form Styles - Diperbaiki untuk dropdown */
        .form-group {
            margin-bottom: 1.25rem;
            position: relative; /* PERBAIKAN: Tambahkan position relative */
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-dark);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 0.9rem;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            background: white;
            position: relative;
            z-index: 2; /* PERBAIKAN: Z-index untuk input */
        }

        /* PERBAIKAN KHUSUS: Dropdown select styling */
        select.form-control {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1em;
            padding-right: 2.5rem;
            cursor: pointer;
        }

        /* PERBAIKAN: Dropdown options harus muncul di atas modal */
        select.form-control option {
            background: white;
            color: var(--text-dark);
            padding: 0.5rem;
            z-index: 3000 !important; /* Sangat tinggi */
            position: relative;
        }

        /* Force dropdown to appear on top in all browsers */
        select.form-control:focus {
            z-index: 3000 !important; /* PERBAIKAN: Z-index sangat tinggi saat focus */
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
            z-index: 3000; /* PERBAIKAN: Z-index tinggi saat focus */
        }

        .form-text {
            font-size: 0.75rem;
            color: var(--text-light);
            margin-top: 0.25rem;
            line-height: 1.3;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            position: relative;
            z-index: 1;
        }

        textarea.form-control {
            resize: vertical;
            min-height: 100px;
        }

        /* Image Preview */
        .image-preview {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            object-fit: cover;
            border: 2px dashed var(--border);
            display: block;
            margin-bottom: 1rem;
            background: var(--light);
        }

        /* File Input */
        .file-input {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-input input[type="file"] {
            position: absolute;
            top: 0;
            right: 0;
            margin: 0;
            padding: 0;
            font-size: 20px;
            cursor: pointer;
            opacity: 0;
            width: 100%;
            height: 100%;
        }

        .file-input-label {
            display: inline-block;
            padding: 0.75rem 1rem;
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text);
            text-align: center;
            width: 100%;
            transition: all 0.3s ease;
        }

        .file-input-label:hover {
            background: #e5e7eb;
            border-color: var(--accent);
        }

        /* Package Manager */
        .package-list {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .package-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            background: var(--light);
        }

        .package-item:last-child {
            border-bottom: none;
        }

        .package-item-header {
            background: white;
            font-weight: 600;
            color: var(--text-dark);
        }

        .package-field {
            flex: 1;
        }

        .package-field input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 0.9rem;
        }

        .package-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Image Manager */
        .image-manager {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .image-item {
            position: relative;
            border-radius: var(--radius);
            overflow: hidden;
            border: 1px solid var(--border);
            background: white;
        }

        .image-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            display: block;
            background: var(--light);
        }

        .image-actions {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            padding: 0.5rem;
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .image-item:hover .image-actions {
            transform: translateY(0);
        }

        /* Banner Manager */
        .banner-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .banner-item {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: transform 0.3s ease;
        }

        .banner-item:hover {
            transform: translateY(-3px);
        }

        .banner-image {
            width: 100%;
            height: 140px;
            object-fit: cover;
            background: var(--light);
        }

        .banner-info {
            padding: 1rem;
        }

        .banner-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 1rem;
            color: var(--text-dark);
        }

        /* Page Content */
        .page-content {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.25rem;
            border-radius: var(--radius);
            background: white;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            z-index: 3000;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            max-width: 350px;
            border-left: 4px solid var(--success);
            border: 1px solid var(--border);
        }

        .notification.active {
            transform: translateX(0);
        }

        .notification.success {
            border-left-color: var(--success);
        }

        .notification.error {
            border-left-color: var(--danger);
        }

        .notification.warning {
            border-left-color: var(--warning);
        }

        .notification-icon {
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .notification.success .notification-icon {
            color: var(--success);
        }

        .notification.error .notification-icon {
            color: var(--danger);
        }

        .notification.warning .notification-icon {
            color: var(--warning);
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-dark);
            cursor: pointer;
            width: 44px;
            height: 44px;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius);
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .mobile-menu-toggle:hover {
            background: var(--light);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .admin-main {
                padding: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }

        @media (max-width: 992px) {
            .admin-sidebar {
                transform: translateX(-100%);
            }
            
            .admin-sidebar.active {
                transform: translateX(0);
                box-shadow: 5px 0 30px rgba(0,0,0,0.2);
            }
            
            .admin-main {
                margin-left: 0;
                width: 100%;
                padding: 0.75rem;
            }
            
            .mobile-menu-toggle {
                display: flex;
            }
            
            .page-title {
                font-size: 1.25rem;
            }
            
            .modal-content {
                max-width: 95%;
            }
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .header-actions {
                width: 100%;
                justify-content: flex-start;
            }
            
            .btn {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
                flex: 1;
                min-width: 120px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-card {
                padding: 1rem;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
            
            table {
                font-size: 0.9rem;
            }
            
            th, td {
                padding: 0.75rem 0.5rem;
            }
            
            .actions {
                flex-direction: row;
            }
            
            .btn-icon {
                width: 32px;
                height: 32px;
                min-width: 32px;
            }
            
            .modal-body {
                padding: 1rem;
            }
            
            .image-manager {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 0.75rem;
            }
            
            .banner-grid {
                grid-template-columns: 1fr;
            }
            
            .notification {
                left: 20px;
                right: 20px;
                max-width: none;
                top: 10px;
            }
            
            .package-item {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .package-field {
                width: 100%;
            }
            
            .package-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }

        @media (max-width: 480px) {
            .admin-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }
            
            .page-title {
                min-width: auto;
                width: 100%;
            }
            
            .header-actions {
                width: 100%;
            }
            
            .btn {
                min-width: 100px;
                padding: 0.6rem 0.75rem;
            }
            
            .product-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .product-image {
                width: 40px;
                height: 40px;
                min-width: 40px;
            }
            
            .modal-header {
                padding: 1rem;
            }
            
            .modal-title {
                font-size: 1.1rem;
            }
            
            .modal-close {
                width: 32px;
                height: 32px;
                font-size: 1.25rem;
            }
        }

        @media (max-width: 360px) {
            .admin-main {
                padding: 0.5rem;
            }
            
            .btn {
                font-size: 0.8rem;
                padding: 0.5rem 0.6rem;
            }
            
            .stat-card {
                padding: 0.75rem;
            }
            
            .image-manager {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Touch Device Optimizations */
        @media (hover: none) and (pointer: coarse) {
            .menu-item:hover {
                background: transparent;
            }
            
            .menu-item.active {
                background: var(--sidebar-hover);
            }
            
            .btn:hover,
            .btn-icon:hover {
                transform: none;
            }
            
            .image-item:hover .image-actions {
                transform: translateY(100%);
            }
            
            .image-item:active .image-actions {
                transform: translateY(0);
            }
            
            .stat-card:hover {
                transform: none;
            }
            
            .banner-item:hover {
                transform: none;
            }
            
            /* PERBAIKAN: Dropdown di mobile */
            select.form-control {
                font-size: 16px; /* Cegah zoom di iOS */
            }
            
            /* Increase tap targets for mobile */
            .menu-item {
                padding: 1rem 1.5rem;
            }
            
            .btn {
                min-height: 44px;
            }
            
            .btn-icon {
                min-width: 44px;
                min-height: 44px;
            }
            
            .modal-close {
                min-width: 44px;
                min-height: 44px;
            }
            
            input[type="number"],
            input[type="text"],
            input[type="email"],
            select,
            textarea {
                font-size: 16px; /* Prevent zoom on iOS */
            }
        }

        /* Print Styles */
        @media print {
            .admin-sidebar,
            .mobile-menu-toggle,
            .header-actions,
            .actions,
            .modal,
            .notification {
                display: none !important;
            }
            
            .admin-main {
                margin-left: 0;
                width: 100%;
            }
            
            .table-container {
                box-shadow: none;
                border: 1px solid #000;
            }
            
            .stat-card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #000;
            }
        }

        /* High Contrast Mode Support */
        @media (prefers-contrast: high) {
            :root {
                --border: #000000;
                --text-light: #000000;
            }
            
            .stat-card,
            .table-container,
            .modal-content {
                border: 2px solid #000000;
            }
            
            select.form-control {
                border: 2px solid #000000;
            }
        }

        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="admin-sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="brand-text">GIVASTORE</div>
                <div class="brand-subtitle">Admin Panel</div>
            </div>
            
            <div class="sidebar-menu">
                <a href="#" class="menu-item active" data-page="dashboard">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="menu-item" data-page="products">
                    <i class="fas fa-box"></i>
                    <span>Kelola Produk</span>
                </a>
                <a href="#" class="menu-item" data-page="categories">
                    <i class="fas fa-tags"></i>
                    <span>Kategori</span>
                </a>
                <a href="#" class="menu-item" data-page="images">
                    <i class="fas fa-images"></i>
                    <span>Gambar Produk</span>
                </a>
                <a href="#" class="menu-item" data-page="banners">
                    <i class="fas fa-image"></i>
                    <span>Banner</span>
                </a>
                <a href="#" class="menu-item" data-page="stock">
                    <i class="fas fa-warehouse"></i>
                    <span>Kelola Stok</span>
                </a>
                <a href="#" class="menu-item" data-page="orders">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Pesanan</span>
                </a>
                <a href="#" class="menu-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Pengaturan</span>
                </a>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">A</div>
                    <div class="user-details">
                        <h4>Admin GIVASTORE</h4>
                        <p>Super Administrator</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="admin-main">
            <div class="admin-header">
                <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="page-title" id="pageTitle">Dashboard</h1>
                <div class="header-actions">
                    <button class="btn btn-outline" id="syncProductsBtn">
                        <i class="fas fa-sync"></i> Sync Products
                    </button>
                    <button class="btn btn-danger" id="resetDataBtn">
                        <i class="fas fa-redo"></i> Reset Data
                    </button>
                    <button class="btn btn-outline" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>

            <!-- Dashboard Content -->
            <div id="dashboardContent" class="page-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon total">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-value" id="totalProducts">0</div>
                        <div class="stat-label">Total Produk</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon active">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-value" id="activeProducts">0</div>
                        <div class="stat-label">Produk Aktif</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon sold-out">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="stat-value" id="soldOutProducts">0</div>
                        <div class="stat-label">Habis Terjual</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon categories">
                            <i class="fas fa-tags"></i>
                        </div>
                        <div class="stat-value" id="totalCategories">0</div>
                        <div class="stat-label">Kategori</div>
                    </div>
                </div>

                <div class="table-container">
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Produk</th>
                                    <th>Kategori</th>
                                    <th>Harga</th>
                                    <th>Stok</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                                <!-- Data akan diisi JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Products Management -->
            <div id="productsContent" class="page-content" style="display: none;">
                <div style="margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                    <h2 style="font-size: 1.25rem; color: var(--text-dark); margin: 0;">Kelola Produk</h2>
                    <button class="btn btn-primary" id="addProductBtn">
                        <i class="fas fa-plus"></i> Tambah Produk
                    </button>
                </div>
                
                <div class="table-container">
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Produk</th>
                                    <th>Kategori</th>
                                    <th>Harga</th>
                                    <th>Stok</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="productsListBody">
                                <!-- Data akan diisi JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Categories Management -->
            <div id="categoriesContent" class="page-content" style="display: none;">
                <div style="margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                    <h2 style="font-size: 1.25rem; color: var(--text-dark); margin: 0;">Kelola Kategori</h2>
                    <button class="btn btn-primary" id="addCategoryBtn">
                        <i class="fas fa-plus"></i> Tambah Kategori
                    </button>
                </div>
                
                <div class="table-container">
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nama Kategori</th>
                                    <th>Jumlah Produk</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="categoriesListBody">
                                <!-- Data akan diisi JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Images Management -->
            <div id="imagesContent" class="page-content" style="display: none;">
                <h2 style="font-size: 1.25rem; color: var(--text-dark); margin-bottom: 1.5rem;">Kelola Gambar Produk</h2>
                
                <div class="image-manager" id="imageManager">
                    <!-- Gambar akan diisi JavaScript -->
                </div>
                
                <div style="margin-top: 1.5rem;">
                    <label class="form-label">Upload Gambar Baru</label>
                    <div class="file-input">
                        <input type="file" id="uploadImage" accept="image/*" multiple>
                        <label class="file-input-label" for="uploadImage">
                            <i class="fas fa-upload"></i> Pilih Gambar
                        </label>
                    </div>
                </div>
            </div>

            <!-- Banners Management -->
            <div id="bannersContent" class="page-content" style="display: none;">
                <h2 style="font-size: 1.25rem; color: var(--text-dark); margin-bottom: 1.5rem;">Kelola Banner</h2>
                
                <div class="banner-grid" id="bannerGrid">
                    <!-- Banner akan diisi JavaScript -->
                </div>
                
                <div style="margin-top: 1.5rem;">
                    <button class="btn btn-primary" id="addBannerBtn">
                        <i class="fas fa-plus"></i> Tambah Banner
                    </button>
                </div>
            </div>

            <!-- Stock Management -->
            <div id="stockContent" class="page-content" style="display: none;">
                <h2 style="font-size: 1.25rem; color: var(--text-dark); margin-bottom: 1.5rem;">Kelola Stok Produk</h2>
                
                <div class="table-container">
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Produk</th>
                                    <th>Stok Saat Ini</th>
                                    <th>Status</th>
                                    <th>Update Stok</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="stockListBody">
                                <!-- Data akan diisi JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Orders Management -->
            <div id="ordersContent" class="page-content" style="display: none;">
                <h2 style="font-size: 1.25rem; color: var(--text-dark); margin-bottom: 1.5rem;">Pesanan Terbaru</h2>
                <div class="table-container">
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID Pesanan</th>
                                    <th>Produk</th>
                                    <th>Customer</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Tanggal</th>
                                </tr>
                            </thead>
                            <tbody id="ordersListBody">
                                <!-- Data akan diisi JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings -->
            <div id="settingsContent" class="page-content" style="display: none;">
                <h2 style="font-size: 1.25rem; color: var(--text-dark); margin-bottom: 1.5rem;">Pengaturan</h2>
                
                <div class="form-group">
                    <label class="form-label">Nama Toko</label>
                    <input type="text" class="form-control" id="storeName" value="GIVASTORE.ID">
                </div>
                
                <div class="form-group">
                    <label class="form-label">WhatsApp Admin</label>
                    <input type="text" class="form-control" id="adminWhatsApp" value="6285189139082">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email Admin</label>
                    <input type="email" class="form-control" id="adminEmail" value="xyzopedia@gmail.com">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Auto Sync Data</label>
                    <select class="form-control" id="autoSync">
                        <option value="yes">Ya - Otomatis sinkronkan data</option>
                        <option value="no">Tidak - Sinkron manual saja</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Auto Redirect ke Sold Page</label>
                    <select class="form-control" id="autoRedirect">
                        <option value="yes">Ya - Otomatis redirect saat stok habis</option>
                        <option value="no">Tidak - Tampilkan pesan stok habis</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" id="saveSettings">
                    <i class="fas fa-save"></i> Simpan Pengaturan
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Add/Edit Product -->
    <div class="modal" id="productModal" role="dialog" aria-labelledby="productModalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="productModalTitle">Tambah Produk Baru</h3>
                <button class="modal-close" id="closeProductModal" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <div class="form-group">
                        <label class="form-label" for="productName">Nama Produk</label>
                        <input type="text" class="form-control" id="productName" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="productCategory">Kategori</label>
                            <select class="form-control" id="productCategory" required>
                                <!-- Kategori akan diisi JavaScript -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="productPrice">Harga</label>
                            <input type="number" class="form-control" id="productPrice" required min="0">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="productOriginalPrice">Harga Asli</label>
                            <input type="number" class="form-control" id="productOriginalPrice" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="productStock">Stok</label>
                            <input type="number" class="form-control" id="productStock" required min="0" value="10">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Gambar Produk</label>
                        <img src="https://via.placeholder.com/100/1E40AF/FFFFFF?text=Produk" alt="Preview" class="image-preview" id="productImagePreview">
                        <div class="file-input">
                            <input type="file" id="productImage" accept="image/*">
                            <label class="file-input-label" for="productImage">
                                <i class="fas fa-upload"></i> Pilih Gambar
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="productUrl">URL Halaman Produk</label>
                        <input type="text" class="form-control" id="productUrl" placeholder="product.html?id=...">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="productDescription">Deskripsi</label>
                        <textarea class="form-control" id="productDescription" rows="3"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="productFlashSale">Flash Sale</label>
                            <select class="form-control" id="productFlashSale">
                                <option value="no">Tidak</option>
                                <option value="yes">Ya</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="productPopular">Produk Populer</label>
                            <select class="form-control" id="productPopular">
                                <option value="no">Tidak</option>
                                <option value="yes">Ya</option>
                            </select>
                        </div>
                    </div>
                    
                    <input type="hidden" id="productId">
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
                        <button type="button" class="btn btn-outline" id="cancelProduct">Batal</button>
                        <button type="submit" class="btn btn-primary">Simpan Produk</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Manage Packages -->
    <div class="modal" id="packagesModal" role="dialog" aria-labelledby="packagesModalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="packagesModalTitle">Kelola Paket Produk</h3>
                <button class="modal-close" id="closePackagesModal" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 1rem;">
                    <h4 style="color: var(--text-dark); margin-bottom: 0.5rem;" id="productNameTitle">Nama Produk</h4>
                    <p style="color: var(--text-light); font-size: 0.9rem;" id="productCategoryTitle">Kategori: -</p>
                </div>
                
                <div class="package-list" id="packagesList">
                    <div class="package-item package-item-header">
                        <div class="package-field">Nama Paket</div>
                        <div class="package-field">Harga</div>
                        <div class="package-field">Durasi</div>
                        <div class="package-field">Aksi</div>
                    </div>
                    <!-- Paket akan diisi JavaScript -->
                </div>
                
                <div style="margin-top: 1.5rem;">
                    <h4 style="color: var(--text-dark); margin-bottom: 1rem;">Tambah Paket Baru</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Nama Paket</label>
                            <input type="text" class="form-control" id="newPackageName" placeholder="Contoh: Netflix Sharing 1P1U">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Harga</label>
                            <input type="number" class="form-control" id="newPackagePrice" placeholder="Contoh: 20000" min="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Durasi</label>
                            <input type="text" class="form-control" id="newPackageDuration" placeholder="Contoh: 1 BULAN">
                        </div>
                    </div>
                    <button class="btn btn-success" id="addPackageBtn">
                        <i class="fas fa-plus"></i> Tambah Paket
                    </button>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap;">
                    <button type="button" class="btn btn-outline" id="cancelPackages">Batal</button>
                    <button type="button" class="btn btn-primary" id="savePackages">Simpan Paket</button>
                </div>
                
                <input type="hidden" id="currentProductId">
            </div>
        </div>
    </div>

    <!-- Modal Add/Edit Category -->
    <div class="modal" id="categoryModal" role="dialog" aria-labelledby="categoryModalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="categoryModalTitle">Tambah Kategori Baru</h3>
                <button class="modal-close" id="closeCategoryModal" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="categoryForm">
                    <div class="form-group">
                        <label class="form-label" for="categoryName">Nama Kategori</label>
                        <input type="text" class="form-control" id="categoryName" required>
                    </div>
                    
                    <input type="hidden" id="categoryId">
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
                        <button type="button" class="btn btn-outline" id="cancelCategory">Batal</button>
                        <button type="submit" class="btn btn-primary">Simpan Kategori</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Add/Edit Banner -->
    <div class="modal" id="bannerModal" role="dialog" aria-labelledby="bannerModalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="bannerModalTitle">Tambah Banner Baru</h3>
                <button class="modal-close" id="closeBannerModal" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="bannerForm">
                    <div class="form-group">
                        <label class="form-label" for="bannerTitle">Nama Banner</label>
                            <input type="text" class="form-control" id="bannerTitle" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Gambar Banner</label>
                        <img src="https://via.placeholder.com/300x100/0A1931/FFFFFF?text=Banner" alt="Preview" class="image-preview" id="bannerImagePreview" style="width: 100%; height: 150px;">
                        <div class="file-input">
                            <input type="file" id="bannerImage" accept="image/*">
                            <label class="file-input-label" for="bannerImage">
                                <i class="fas fa-upload"></i> Pilih Gambar Banner
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="bannerUrl">Link URL</label>
                        <input type="text" class="form-control" id="bannerUrl" placeholder="https://...">
                    </div>
                    
                    <input type="hidden" id="bannerId">
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
                        <button type="button" class="btn btn-outline" id="cancelBanner">Batal</button>
                        <button type="submit" class="btn btn-primary">Simpan Banner</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification" role="alert" aria-live="polite">
        <i class="fas fa-check-circle notification-icon"></i>
        <span id="notificationMessage">Data berhasil disimpan!</span>
    </div>

    <!-- Load Scripts -->
    <script src="js/produk.js"></script>
    <script src="js/products-data.js"></script>
    
    <script>
        // ==================== KONFIGURASI SISTEM ====================
        const SYSTEM_CONFIG = {
            // Mapping nama dari products-data.js ke produk.js
            NAME_MAPPING: {
                'Netflix Premium': 'NETFLIX',
                'Vidio Premium': 'VIDIO',
                'Disney+ Hotstar': 'DISNEY+',
                'YouTube Premium': 'YOUTUBE',
                'Amazon Prime Video': 'AMAZON PRIME',
                'iQIYI Premium': 'IQIYI',
                'Dramabox Premium': 'DRAMABOX',
                'Loklok Premium': 'LOKLOK',
                'Viu Premium': 'VIU',
                'HBO Go': 'HBO GO',
                'WeTV VIP': 'WETV',
                'HBO Max': 'HBO GO MAX',
                'Bstation Premium': 'BSTATION',
                'Youkou VIP': 'YOUKOU',
                'Crunchyroll': 'CRUNCHYROLL',
                'Spotify Premium': 'SPOTIFY',
                'Apple Music': 'APPLE MUSIC',
                'Canva Pro': 'CANVA',
                'Capcut Pro': 'CAPCUT',
                'Remini Pro': 'REMINI',
                'Meitu VIP': 'MEITU',
                'Picsart Gold': 'PICSART',
                'Oldroll': 'OLDROLL',
                'Ibis Paint X Pro': 'IBIS PAINT X',
                'Alight Motion Pro': 'Alight Motion',
                'Dazzcam': 'DAZZCAM',
                'ChatGPT': 'CHATGPT'
            },
            
            // Produk yang otomatis di-mark sebagai populer
            POPULAR_PRODUCTS: ['NETFLIX', 'SPOTIFY', 'CANVA', 'YOUTUBE', 'Alight Motion', 'VIDIO', 'CHATGPT', 'BSTATION'],
            
            // Default values
            DEFAULT_STOCK: 10,
            DEFAULT_SOLD_MIN: 100,
            DEFAULT_SOLD_MAX: 2000,
            
            // Flash sale threshold
            FLASH_SALE_DISCOUNT: 40
        };

        // ==================== DATA STORAGE ====================
        let products = [];
        let categories = [];
        let banners = [];
        let images = [];
        let orders = [];
        let currentProductId = 0;

        // ==================== METODE 1: LOAD PRODUK ====================
        
        function loadProductsMethod1() {
            console.log(' METODE 1: Memuat produk dari produk.js (utama) + update dari products-data.js');
            
            const loadedProducts = [];
            const productMap = new Map();
            let productId = 1;
            
            // ========== STEP 1: LOAD DARI produk.js ==========
            if (typeof semuaProduk !== 'undefined') {
                console.log(' STEP 1: Memuat dari produk.js...');
                
                Object.values(semuaProduk).forEach(product => {
                    const productKey = normalizeProductKey(product.name);
                    
                    // CEK DUPLIKASI
                    if (productMap.has(productKey)) {
                        console.log(` Skip duplikat: ${product.name}`);
                        return;
                    }
                    
                    // Hitung harga dari paket
                    const packages = product.packages || [];
                    const minPrice = calculateMinPrice(packages);
                    const maxPrice = calculateMaxPrice(packages);
                    
                    // Tentukan kategori
                    const category = normalizeCategory(product.category);
                    
                    // Buat data produk
                    const productData = createProductData({
                        id: productId++,
                        name: product.name,
                        category: category,
                        price: minPrice,
                        originalPrice: maxPrice * 1.5 > minPrice ? maxPrice * 1.5 : minPrice * 2,
                        image: getProductImage(product),
                        description: product.description || generateDescription(product.name, category),
                        packages: packages,
                        source: 'produk.js'
                    });
                    
                    loadedProducts.push(productData);
                    productMap.set(productKey, loadedProducts.length - 1);
                });
                
                console.log(`    ${loadedProducts.length} produk dimuat dari produk.js`);
            }
            
            // ========== STEP 2: UPDATE DARI products-data.js ==========
            if (typeof window.productData !== 'undefined' && window.productData.products) {
                console.log(' STEP 2: Update data tambahan dari products-data.js...');
                
                let updatedCount = 0;
                
                window.productData.products.forEach(productData => {
                    // Cari mapping nama
                    const mappedName = SYSTEM_CONFIG.NAME_MAPPING[productData.name] || productData.name;
                    const productKey = normalizeProductKey(mappedName);
                    
                    // Cari produk yang sudah ada
                    if (productMap.has(productKey)) {
                        const index = productMap.get(productKey);
                        const existingProduct = loadedProducts[index];
                        
                        // UPDATE data tambahan
                        updateProductFromDataJS(existingProduct, productData);
                        updatedCount++;
                        
                        existingProduct.source = 'produk.js + products-data.js';
                    }
                });
                
                console.log(`    ${updatedCount} produk diperbarui dari products-data.js`);
            }
            
            console.log(` TOTAL: ${loadedProducts.length} produk (0 duplikasi)`);
            currentProductId = loadedProducts.length;
            
            return loadedProducts;
        }
        
        function calculateMinPrice(packages) {
            if (!packages || packages.length === 0) return 0;
            const prices = packages.map(p => p.price || 0).filter(p => p > 0);
            return prices.length > 0 ? Math.min(...prices) : 0;
        }
        
        function calculateMaxPrice(packages) {
            if (!packages || packages.length === 0) return 0;
            const prices = packages.map(p => p.price || 0).filter(p => p > 0);
            return prices.length > 0 ? Math.max(...prices) : 0;
        }
        
        function normalizeProductKey(name) {
            return name.toLowerCase()
                .replace(/[^a-z0-9]/g, '')
                .replace(/premium|pro|vip|plus|max|go|hotstar/g, '')
                .trim();
        }
        
        function normalizeCategory(category) {
            if (!category) return 'Streaming';
            const cat = category.toLowerCase();
            if (cat.includes('streaming')) return 'Streaming';
            if (cat.includes('musik')) return 'Musik';
            if (cat.includes('edit')) return 'Editing';
            if (cat === 'ai') return 'AI';
            return category;
        }
        
        function getProductImage(product) {
            if (product.logo) return product.logo;
            if (product.bannerImage) return product.bannerImage;
            
            const imageMap = {
                'netflix': '../image/netflix.png',
                'spotify': '../image/spotify.png',
                'canva': '../image/canva.png',
                'youtube': '../image/youtube.png',
                'vidio': '../image/vidio.png',
                'disney': '../image/disneyplus.png',
                'amazon': '../image/prime-video.png',
                'iqiyi': '../image/iqiyi.png',
                'dramabox': '../image/dramabox.png',
                'loklok': '../image/loklok.png',
                'viu': '../image/viu.png',
                'hbo': '../image/hbo-go.png',
                'wetv': '../image/wetv.png',
                'hbo max': '../image/hbo-go-max-com.png',
                'bstation': '../image/bstation.png',
                'youkou': '../image/youkou.png',
                'crunchyroll': '../image/crunchyroll.png',
                'apple music': '../image/applemusic.png',
                'capcut': '../image/capcut.png',
                'remini': '../image/remini.png',
                'meitu': '../image/meitu.png',
                'picsart': '../image/picsart.png',
                'oldroll': '../image/oldroll.png',
                'ibis': '../image/ibispaint.png',
                'alight motion': '../image/alight-motion.png',
                'dazzcam': '../image/dazzcam.png',
                'chatgpt': '../image/chatgpt.png'
            };
            
            const lowerName = product.name.toLowerCase();
            for (const [key, image] of Object.entries(imageMap)) {
                if (lowerName.includes(key)) {
                    return image;
                }
            }
            
            return `https://via.placeholder.com/150/1E40AF/FFFFFF?text=${encodeURIComponent(product.name.substring(0, 10))}`;
        }
        
        function generateDescription(name, category) {
            const descriptions = {
                'Streaming': `Layanan streaming ${name} premium dengan kualitas HD, tanpa iklan, dan akses ke semua konten eksklusif.`,
                'Musik': `Layanan musik ${name} premium dengan jutaan lagu, tanpa iklan, dan fitur download untuk offline listening.`,
                'Editing': `Aplikasi editing ${name} pro dengan semua fitur premium, template eksklusif, dan tanpa watermark.`,
                'AI': `Akses premium ke ${name} dengan kemampuan AI terbaru, tanpa batasan penggunaan, dan prioritas support.`
            };
            
            return descriptions[category] || `Paket ${name} premium dengan akses penuh dan fitur lengkap.`;
        }
        
        function createProductData(baseData) {
            const discount = baseData.originalPrice > 0 && baseData.price > 0 ?
                Math.round(((baseData.originalPrice - baseData.price) / baseData.originalPrice) * 100) : 0;
            
            const isPopular = SYSTEM_CONFIG.POPULAR_PRODUCTS.some(popName => 
                baseData.name.toUpperCase().includes(popName.toUpperCase())
            );
            
            const isFlashSale = discount > SYSTEM_CONFIG.FLASH_SALE_DISCOUNT;
            
            return {
                ...baseData,
                stock: SYSTEM_CONFIG.DEFAULT_STOCK,
                status: SYSTEM_CONFIG.DEFAULT_STOCK > 0 ? 'active' : 'sold-out',
                isFlashSale: isFlashSale,
                isPopular: isPopular,
                pageUrl: baseData.pageUrl || `../pages/product.html?product=${encodeURIComponent(baseData.name)}`,
                sold: Math.floor(Math.random() * (SYSTEM_CONFIG.DEFAULT_SOLD_MAX - SYSTEM_CONFIG.DEFAULT_SOLD_MIN)) + SYSTEM_CONFIG.DEFAULT_SOLD_MIN,
                discount: discount,
                features: getDefaultFeatures(baseData.category)
            };
        }
        
        function updateProductFromDataJS(existingProduct, newData) {
            // Update hanya data yang lebih baik
            if (newData.description && newData.description.length > existingProduct.description.length) {
                existingProduct.description = newData.description;
            }
            
            if (newData.stock !== undefined) {
                existingProduct.stock = newData.stock;
                existingProduct.status = newData.stock > 0 ? 'active' : 'sold-out';
            }
            
            if (newData.sold !== undefined && newData.sold > existingProduct.sold) {
                existingProduct.sold = newData.sold;
            }
            
            if (newData.isFlashSale !== undefined) {
                existingProduct.isFlashSale = newData.isFlashSale;
            }
            
            if (newData.isPopular !== undefined) {
                existingProduct.isPopular = newData.isPopular;
            }
            
            if (newData.originalPrice && newData.originalPrice > existingProduct.originalPrice) {
                existingProduct.originalPrice = newData.originalPrice;
            }
            
            if (newData.discount !== undefined) {
                existingProduct.discount = newData.discount;
            }
            
            if (newData.features && newData.features.length > 0) {
                existingProduct.features = newData.features;
            }
            
            if (newData.image && !existingProduct.image.includes('placeholder')) {
                existingProduct.image = newData.image;
            }
        }
        
        function getDefaultFeatures(category) {
            const features = {
                'Streaming': ["Aktif Instan", "Garansi 30 Hari", "Support 24/7", "Kualitas HD", "No Ads"],
                'Musik': ["No Ads", "Download Lagu", "High Quality Audio", "Support 24/7", "All Access"],
                'Editing': ["All Features", "No Watermark", "Premium Templates", "Lifetime Update", "Support"],
                'AI': ["Full Access", "No Limits", "Priority Support", "Latest Models", "API Access"]
            };
            
            return features[category] || ["Aktif Instan", "Garansi 30 Hari", "Support 24/7"];
        }

        // ==================== DATA MANAGEMENT ====================
        
        function loadData() {
            console.log(' Memuat data admin...');
            
            // Load products
            const savedProducts = localStorage.getItem('admin_products');
            if (savedProducts) {
                try {
                    products = JSON.parse(savedProducts);
                    console.log(` ${products.length} produk dimuat dari localStorage`);
                    currentProductId = products.length > 0 ? Math.max(...products.map(p => p.id)) : 0;
                } catch (e) {
                    console.error('Error:', e);
                    products = [];
                }
            }
            
            if (products.length === 0) {
                console.log(' Memuat produk dari file...');
                products = loadProductsMethod1();
                saveProducts();
                console.log(` ${products.length} produk disimpan`);
            }
            
            // Load categories
            const savedCategories = localStorage.getItem('admin_categories');
            if (savedCategories) {
                try {
                    categories = JSON.parse(savedCategories);
                } catch (e) {
                    console.error('Error:', e);
                    categories = [];
                }
            }
            
            if (categories.length === 0) {
                categories = generateCategories();
                saveCategories();
            }
            
            // Load other data
            loadOtherData();
            
            // Update UI - PERBAIKAN: Panggil updateCategoryDropdown di sini
            updateStats();
            loadDashboardProducts();
            updateMainSiteProducts();
            updateCategoryDropdown(); // <--- PERBAIKAN: Tambahkan ini
            
            // Check consistency
            setTimeout(checkDataConsistency, 1000);
        }
        
        function generateCategories() {
            const categoryMap = {};
            
            products.forEach(product => {
                const cat = product.category;
                categoryMap[cat] = (categoryMap[cat] || 0) + 1;
            });
            
            const categories = [];
            let id = 1;
            
            Object.entries(categoryMap).forEach(([name, count]) => {
                categories.push({
                    id: id++,
                    name: name,
                    count: count
                });
            });
            
            // Add default categories if missing
            const defaultCats = ['Streaming', 'Musik', 'Editing', 'AI'];
            defaultCats.forEach(catName => {
                if (!categories.find(c => c.name === catName)) {
                    categories.push({
                        id: id++,
                        name: catName,
                        count: 0
                    });
                }
            });
            
            return categories;
        }
        
        function loadOtherData() {
            // Banners
            const savedBanners = localStorage.getItem('admin_banners');
            if (savedBanners) {
                try {
                    banners = JSON.parse(savedBanners);
                } catch (e) {
                    banners = [];
                }
            }
            
            if (banners.length === 0) {
                banners = [
                    { id: 1, title: "Flash Sale", image: "image/baner1.jpg", url: "#" },
                    { id: 2, title: "Produk Terbaru", image: "image/baner2.jpg", url: "#" },
                    { id: 3, title: "Promo Spesial", image: "image/baner3.jpg", url: "#" }
                ];
                saveBanners();
            }
            
            // Images
            const savedImages = localStorage.getItem('admin_images');
            if (savedImages) {
                try {
                    images = JSON.parse(savedImages);
                } catch (e) {
                    images = [];
                }
            }
            
            if (images.length === 0) {
                images = [
                    { id: 1, name: "netflix.jpg", url: "../image/netflix.png", type: "product" },
                    { id: 2, name: "spotify.jpg", url: "../image/spotify.png", type: "product" },
                    { id: 3, name: "canva.jpg", url: "../image/canva.png", type: "product" }
                ];
                saveImages();
            }
            
            // Orders
            const savedOrders = localStorage.getItem('admin_orders');
            if (savedOrders) {
                try {
                    orders = JSON.parse(savedOrders);
                } catch (e) {
                    orders = [];
                }
            }
            
            if (orders.length === 0) {
                orders = [
                    { id: "ORD001", product: "NETFLIX", customer: "081234567890", total: 31000, status: "completed", date: "2025-01-15" },
                    { id: "ORD002", product: "SPOTIFY", customer: "081987654321", total: 26000, status: "pending", date: "2025-01-16" },
                    { id: "ORD003", product: "CANVA", customer: "082112345678", total: 8000, status: "completed", date: "2025-01-17" }
                ];
                saveOrders();
            }
        }
        
        function saveProducts() {
            try {
                localStorage.setItem('admin_products', JSON.stringify(products));
                updateMainSiteProducts();
                console.log(' Produk disimpan');
            } catch (e) {
                console.error('Error:', e);
                showNotification('Gagal menyimpan produk', 'error');
            }
        }
        
        function saveCategories() {
            try {
                localStorage.setItem('admin_categories', JSON.stringify(categories));
            } catch (e) {
                console.error('Error:', e);
            }
        }
        
        function saveBanners() {
            try {
                localStorage.setItem('admin_banners', JSON.stringify(banners));
            } catch (e) {
                console.error('Error:', e);
            }
        }
        
        function saveImages() {
            try {
                localStorage.setItem('admin_images', JSON.stringify(images));
            } catch (e) {
                console.error('Error:', e);
            }
        }
        
        function saveOrders() {
            try {
                localStorage.setItem('admin_orders', JSON.stringify(orders));
            } catch (e) {
                console.error('Error:', e);
            }
        }
        
        function updateMainSiteProducts() {
            try {
                const productData = {
                    products: products.map(p => ({
                        id: p.id,
                        name: p.name,
                        category: p.category,
                        price: p.price,
                        originalPrice: p.originalPrice || null,
                        image: p.image,
                        discount: p.discount || 0,
                        isPopular: p.isPopular || false,
                        isFlashSale: p.isFlashSale || false,
                        pageUrl: p.pageUrl || "#",
                        stock: p.stock || 0,
                        status: p.status || "active",
                        sold: p.sold || 0,
                        description: p.description || "",
                        packages: p.packages || [],
                        features: p.features || []
                    })),
                    categories: categories.map(c => ({ 
                        id: c.id, 
                        name: c.name 
                    }))
                };
                
                localStorage.setItem('productData', JSON.stringify(productData));
                console.log(' Data produk utama diperbarui');
            } catch (e) {
                console.error('Error:', e);
            }
        }

        // ==================== UI FUNCTIONS ====================
        
        function updateStats() {
            try {
                const totalProducts = products.length;
                const activeProducts = products.filter(p => p.status === 'active').length;
                const soldOutProducts = products.filter(p => p.status === 'sold-out').length;
                const totalCategories = categories.length;
                
                document.getElementById('totalProducts').textContent = totalProducts;
                document.getElementById('activeProducts').textContent = activeProducts;
                document.getElementById('soldOutProducts').textContent = soldOutProducts;
                document.getElementById('totalCategories').textContent = totalCategories;
            } catch (e) {
                console.error('Error:', e);
            }
        }
        
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationMessage = document.getElementById('notificationMessage');
            
            notification.className = `notification ${type}`;
            notificationMessage.textContent = message;
            notification.classList.add('active');
            
            setTimeout(() => {
                notification.classList.remove('active');
            }, 3000);
        }
        
        function loadDashboardProducts() {
            const tbody = document.getElementById('productsTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            products.slice(0, 10).forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="product-info">
                            <img src="${product.image}" alt="${product.name}" class="product-image">
                            <div>
                                <div class="product-name">${product.name}</div>
                                <span class="product-category">${product.category}</span>
                            </div>
                        </div>
                    </td>
                    <td>${product.category}</td>
                    <td class="price">Rp ${product.price.toLocaleString('id-ID')}</td>
                    <td>${product.stock}</td>
                    <td>
                        <span class="status-badge ${product.status === 'active' ? 'status-active' : 'status-sold-out'}">
                            ${product.status === 'active' ? 'Aktif' : 'Habis'}
                        </span>
                    </td>
                    <td>
                        <div class="actions">
                            <button class="btn-icon btn-package" onclick="openManagePackages(${product.id})" title="Kelola Paket">
                                <i class="fas fa-boxes"></i>
                            </button>
                            <button class="btn-icon btn-edit" onclick="editProduct(${product.id})" title="Edit Produk">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon btn-delete" onclick="deleteProduct(${product.id})" title="Hapus Produk">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadProductsManagement() {
            const tbody = document.getElementById('productsListBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="product-info">
                            <img src="${product.image}" alt="${product.name}" class="product-image">
                            <div>
                                <div class="product-name">${product.name}</div>
                                <div style="font-size: 0.85rem; color: var(--text-light);">
                                    ${product.description.substring(0, 60)}...
                                </div>
                                <div style="font-size: 0.75rem; color: var(--text-light); margin-top: 0.25rem;">
                                    <i class="fas fa-box"></i> ${product.packages.length} paket
                                </div>
                            </div>
                        </div>
                    </td>
                    <td>${product.category}</td>
                    <td class="price">Rp ${product.price.toLocaleString('id-ID')}</td>
                    <td>${product.stock}</td>
                    <td>
                        <span class="status-badge ${product.status === 'active' ? 'status-active' : 'status-sold-out'}">
                            ${product.status === 'active' ? 'Aktif' : 'Habis'}
                        </span>
                    </td>
                    <td>
                        <div class="actions">
                            <button class="btn-icon btn-package" onclick="openManagePackages(${product.id})" title="Kelola Paket">
                                <i class="fas fa-boxes"></i>
                            </button>
                            <button class="btn-icon btn-edit" onclick="editProduct(${product.id})" title="Edit Produk">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon btn-delete" onclick="deleteProduct(${product.id})" title="Hapus Produk">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadCategories() {
            const tbody = document.getElementById('categoriesListBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Update counts
            categories.forEach(category => {
                category.count = products.filter(p => p.category === category.name).length;
            });
            saveCategories();
            
            categories.forEach(category => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${category.name}</td>
                    <td>${category.count} produk</td>
                    <td>
                        <div class="actions">
                            <button class="btn-icon btn-edit" onclick="editCategory(${category.id})" title="Edit Kategori">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon btn-delete" onclick="deleteCategory(${category.id})" title="Hapus Kategori">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            updateCategoryDropdown();
        }
        
        function loadImages() {
            const container = document.getElementById('imageManager');
            if (!container) return;
            
            container.innerHTML = '';
            
            images.forEach(image => {
                const item = document.createElement('div');
                item.className = 'image-item';
                item.innerHTML = `
                    <img src="${image.url}" alt="${image.name}">
                    <div class="image-actions">
                        <button class="btn-icon btn-edit" onclick="useImage('${image.url}')" title="Gunakan Gambar">
                            <i class="fas fa-link"></i>
                        </button>
                        <button class="btn-icon btn-delete" onclick="deleteImage(${image.id})" title="Hapus Gambar">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        function loadBanners() {
            const container = document.getElementById('bannerGrid');
            if (!container) return;
            
            container.innerHTML = '';
            
            banners.forEach(banner => {
                const item = document.createElement('div');
                item.className = 'banner-item';
                item.innerHTML = `
                    <img src="${banner.image}" alt="${banner.title}" class="banner-image">
                    <div class="banner-info">
                        <div class="banner-name">${banner.title}</div>
                        <div style="font-size: 0.85rem; color: var(--text-light); margin-bottom: 0.5rem;">${banner.url}</div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn-icon btn-edit" style="font-size: 0.8rem;" onclick="editBanner(${banner.id})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn-icon btn-delete" style="font-size: 0.8rem;" onclick="deleteBanner(${banner.id})">
                                <i class="fas fa-trash"></i> Hapus
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        function loadStockManagement() {
            const tbody = document.getElementById('stockListBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="product-info">
                            <img src="${product.image}" alt="${product.name}" class="product-image">
                            <div>
                                <div class="product-name">${product.name}</div>
                                <span class="product-category">${product.category}</span>
                            </div>
                        </div>
                    </td>
                    <td>${product.stock}</td>
                    <td>
                        <span class="status-badge ${product.status === 'active' ? 'status-active' : 'status-sold-out'}">
                            ${product.status === 'active' ? 'Aktif' : 'Habis'}
                        </span>
                    </td>
                    <td>
                        <input type="number" class="form-control" style="width: 100px;" 
                               value="${product.stock}" min="0" 
                               onchange="updateStock(${product.id}, this.value)"
                               title="Update stok">
                    </td>
                    <td>
                        <button class="btn btn-danger" onclick="setSoldOut(${product.id})" 
                                ${product.stock > 0 ? '' : 'disabled'} title="Set Habis">
                            <i class="fas fa-times"></i> Set Habis
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadOrders() {
            const tbody = document.getElementById('ordersListBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            orders.forEach(order => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${order.id}</td>
                    <td>${order.product}</td>
                    <td>${order.customer}</td>
                    <td class="price">Rp ${order.total.toLocaleString('id-ID')}</td>
                    <td>
                        <span class="status-badge ${order.status === 'completed' ? 'status-active' : 'status-warning'}">
                            ${order.status === 'completed' ? 'Selesai' : 'Pending'}
                        </span>
                    </td>
                    <td>${order.date}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function updateCategoryDropdown() {
            const select = document.getElementById('productCategory');
            if (!select) {
                console.log(' Dropdown kategori tidak ditemukan di DOM');
                return;
            }
            
            console.log(' Memperbarui dropdown kategori...');
            console.log('    Jumlah kategori:', categories.length);
            
            // Simpan nilai yang dipilih sebelumnya
            const previousValue = select.value;
            
            // Bersihkan dropdown
            select.innerHTML = '<option value="">Pilih Kategori</option>';
            
            // Tambahkan kategori
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.name;
                option.textContent = category.name;
                select.appendChild(option);
            });
            
            // Kembalikan nilai yang dipilih sebelumnya jika ada
            if (previousValue && categories.some(c => c.name === previousValue)) {
                select.value = previousValue;
            }
            
            console.log(' Dropdown kategori diperbarui');
        }
        
        // Fungsi baru untuk mengisi dropdown di modal
        function populateCategoryDropdown() {
            const select = document.getElementById('productCategory');
            if (!select || select.options.length > 1) return; // Sudah ada isinya
            
            updateCategoryDropdown();
        }

        // ==================== CRUD OPERATIONS ====================
        
        function addProduct(productData) {
            try {
                currentProductId++;
                const newProduct = {
                    id: currentProductId,
                    name: productData.name,
                    category: productData.category,
                    price: productData.price || 0,
                    originalPrice: productData.originalPrice || productData.price * 1.5,
                    image: productData.image || 'https://via.placeholder.com/150/1E40AF/FFFFFF?text=Produk',
                    stock: productData.stock || SYSTEM_CONFIG.DEFAULT_STOCK,
                    status: (productData.stock || SYSTEM_CONFIG.DEFAULT_STOCK) > 0 ? 'active' : 'sold-out',
                    isFlashSale: productData.isFlashSale || false,
                    isPopular: productData.isPopular || false,
                    pageUrl: productData.pageUrl || `../pages/product.html?product=${encodeURIComponent(productData.name)}`,
                    description: productData.description || '',
                    packages: productData.packages || [],
                    sold: 0,
                    discount: productData.originalPrice > 0 && productData.price > 0 ?
                        Math.round(((productData.originalPrice - productData.price) / productData.originalPrice) * 100) : 0,
                    features: getDefaultFeatures(productData.category),
                    source: 'admin panel'
                };
                
                products.push(newProduct);
                saveProducts();
                showNotification('Produk berhasil ditambahkan');
                
                // Update UI
                loadProductsManagement();
                loadDashboardProducts();
                updateStats();
                
            } catch (e) {
                console.error('Error:', e);
                showNotification('Gagal menambahkan produk', 'error');
            }
        }
        
        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            
            // Fill form
            document.getElementById('productName').value = product.name;
            document.getElementById('productPrice').value = product.price;
            document.getElementById('productOriginalPrice').value = product.originalPrice || '';
            document.getElementById('productStock').value = product.stock;
            document.getElementById('productUrl').value = product.pageUrl || '';
            document.getElementById('productDescription').value = product.description || '';
            document.getElementById('productFlashSale').value = product.isFlashSale ? 'yes' : 'no';
            document.getElementById('productPopular').value = product.isPopular ? 'yes' : 'no';
            document.getElementById('productId').value = product.id;
            document.getElementById('productImagePreview').src = product.image;
            
            // Set category - PERBAIKAN: Pastikan dropdown sudah terisi
            populateCategoryDropdown();
            const categorySelect = document.getElementById('productCategory');
            categorySelect.value = product.category;
            
            // Update modal title
            document.getElementById('productModalTitle').textContent = 'Edit Produk';
            
            // Show modal
            document.getElementById('productModal').classList.add('active');
        }
        
        function updateProduct(id, updatedData) {
            try {
                const index = products.findIndex(p => p.id === id);
                if (index === -1) return;
                
                updatedData.status = updatedData.stock > 0 ? 'active' : 'sold-out';
                
                // Keep packages if not provided
                if (!updatedData.packages) {
                    updatedData.packages = products[index].packages || [];
                }
                
                // Update product
                products[index] = { ...products[index], ...updatedData };
                saveProducts();
                showNotification('Produk berhasil diperbarui');
                
                // Update UI
                loadProductsManagement();
                loadDashboardProducts();
                updateStats();
                
            } catch (e) {
                console.error('Error:', e);
                showNotification('Gagal memperbarui produk', 'error');
            }
        }
        
        function deleteProduct(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus produk ini?')) return;
            
            try {
                products = products.filter(p => p.id !== id);
                saveProducts();
                showNotification('Produk berhasil dihapus');
                
                // Update UI
                loadProductsManagement();
                loadDashboardProducts();
                updateStats();
                
            } catch (e) {
                console.error('Error:', e);
                showNotification('Gagal menghapus produk', 'error');
            }
        }
        
        function addCategory(name) {
            try {
                const newId = categories.length > 0 ? Math.max(...categories.map(c => c.id)) + 1 : 1;
                categories.push({ id: newId, name, count: 0 });
                saveCategories();
                showNotification('Kategori berhasil ditambahkan');
                loadCategories();
                updateStats();
                updateCategoryDropdown(); // PERBAIKAN: Update dropdown setelah menambah kategori
            } catch (e) {
                console.error('Error:', e);
                showNotification('Gagal menambahkan kategori', 'error');
            }
        }
        
        function editCategory(id) {
            const category = categories.find(c => c.id === id);
            if (!category) return;
            
            document.getElementById('categoryName').value = category.name;
            document.getElementById('categoryId').value = category.id;
            document.getElementById('categoryModalTitle').textContent = 'Edit Kategori';
            document.getElementById('categoryModal').classList.add('active');
        }
        
        function updateCategory(id, name) {
            try {
                const index = categories.findIndex(c => c.id === id);
                if (index === -1) return;
                
                const oldName = categories[index].name;
                categories[index].name = name;
                
                // Update products with this category
                products.forEach(product => {
                    if (product.category === oldName) {
                        product.category = name;
                    }
                });
                
                saveCategories();
                saveProducts();
                showNotification('Kategori berhasil diperbarui');
                
                // Update UI
                loadCategories();
                loadProductsManagement();
                updateCategoryDropdown(); // PERBAIKAN: Update dropdown setelah mengedit
                
            } catch (e) {
                console.error('Error:', e);
                showNotification('Gagal memperbarui kategori', 'error');
            }
        }
        
        function deleteCategory(id) {
            try {
                const category = categories.find(c => c.id === id);
                if (!category) return;
                
                const productsWithCategory = products.filter(p => p.category === category.name);
                
                if (productsWithCategory.length > 0) {
                    if (!confirm(`Kategori ini digunakan oleh ${productsWithCategory.length} produk. Tetap hapus?`)) {
                        return;
                    }
                }
                
                categories = categories.filter(c => c.id !== id);
                saveCategories();
                showNotification('Kategori berhasil dihapus');
                loadCategories();
                updateStats();
                updateCategoryDropdown(); // PERBAIKAN: Update dropdown setelah menghapus
                
            } catch (e) {
                console.error('Error:', e);
                showNotification('Gagal menghapus kategori', 'error');
            }
        }
        
        function addBanner(banner) {
            try {
                const newId = banners.length > 0 ? Math.max(...banners.map(b => b.id)) + 1 : 1;
                banner.id = newId;
                banners.push(banner);
                saveBanners();
                showNotification('Banner berhasil ditambahkan');
                loadBanners();
            } catch (e) {
                console.error('Error:', e);
                showNotification('Gagal menambahkan banner', 'error');
            }
        }
        
        function editBanner(id) {
            const banner = banners.find(b => b.id === id);
            if (!banner) return;
            
            document.getElementById('bannerTitle').value = banner.title;
            document.getElementById('bannerUrl').value = banner.url;
            document.getElementById('bannerId').value = banner.id;
            document.getElementById('bannerImagePreview').src = banner.image;
            document.getElementById('bannerModalTitle').textContent = 'Edit Banner';
            document.getElementById('bannerModal').classList.add('active');
        }
        
        function updateBanner(id, updatedData) {
            try {
                const index = banners.findIndex(b => b.id === id);
                if (index === -1) return;
                
                banners[index] = { ...banners[index], ...updatedData };
                saveBanners();
                showNotification('Banner berhasil diperbarui');
                loadBanners();
            } catch (e) {
                console.error('Error:', e);
                showNotification('Gagal memperbarui banner', 'error');
            }
        }
        
        function deleteBanner(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus banner ini?')) return;
            
            try {
                banners = banners.filter(b => b.id !== id);
                saveBanners();
                showNotification('Banner berhasil dihapus');
                loadBanners();
            } catch (e) {
                console.error('Error:', e);
                showNotification('Gagal menghapus banner', 'error');
            }
        }
        
        function uploadImage(file) {
            if (!file.type.match('image.*')) {
                showNotification('File harus berupa gambar', 'error');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                showNotification('Ukuran gambar maksimal 5MB', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const newId = images.length > 0 ? Math.max(...images.map(i => i.id)) + 1 : 1;
                    const newImage = {
                        id: newId,
                        name: file.name,
                        url: e.target.result,
                        type: 'product'
                    };
                    images.push(newImage);
                    saveImages();
                    showNotification('Gambar berhasil diupload');
                    loadImages();
                } catch (e) {
                    console.error('Error:', e);
                    showNotification('Gagal mengupload gambar', 'error');
                }
            };
            reader.onerror = function() {
                showNotification('Gagal membaca file gambar', 'error');
            };
            reader.readAsDataURL(file);
        }
        
        function deleteImage(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus gambar ini?')) return;
            
            try {
                images = images.filter(i => i.id !== id);
                saveImages();
                showNotification('Gambar berhasil dihapus');
                loadImages();
            } catch (e) {
                console.error('Error:', e);
                showNotification('Gagal menghapus gambar', 'error');
            }
        }
        
        function updateStock(productId, newStock) {
            try {
                const product = products.find(p => p.id === productId);
                if (!product) return;
                
                newStock = parseInt(newStock);
                if (isNaN(newStock)) {
                    showNotification('Stok harus berupa angka', 'error');
                    return;
                }
                
                product.stock = newStock;
                
                if (newStock === 0) {
                    const autoRedirect = document.getElementById('autoRedirect').value;
                    if (autoRedirect === 'yes') {
                        product.status = 'sold-out';
                        showNotification(`Produk ${product.name} habis. Akan redirect ke sold.html`);
                    }
                } else if (newStock > 0 && product.status === 'sold-out') {
                    product.status = 'active';
                }
                
                saveProducts();
                showNotification('Stok berhasil diperbarui');
                
                // Update UI
                loadStockManagement();
                loadProductsManagement();
                loadDashboardProducts();
                updateStats();
                
            } catch (e) {
                console.error('Error:', e);
                showNotification('Gagal memperbarui stok', 'error');
            }
        }
        
        function setSoldOut(productId) {
            try {
                const product = products.find(p => p.id === productId);
                if (!product) return;
                
                product.stock = 0;
                product.status = 'sold-out';
                saveProducts();
                showNotification('Produk diatur sebagai habis terjual');
                
                // Update UI
                loadStockManagement();
                loadProductsManagement();
                loadDashboardProducts();
                updateStats();
                
            } catch (e) {
                console.error('Error:', e);
                showNotification('Gagal mengatur produk sebagai habis', 'error');
            }
        }

        // ==================== PACKAGE MANAGEMENT ====================
        
        function openManagePackages(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            document.getElementById('productNameTitle').textContent = product.name;
            document.getElementById('productCategoryTitle').textContent = `Kategori: ${product.category}`;
            document.getElementById('currentProductId').value = productId;
            
            loadPackagesToModal(product.packages || []);
            document.getElementById('packagesModal').classList.add('active');
        }
        
        function loadPackagesToModal(packages) {
            const packagesList = document.getElementById('packagesList');
            // Clear existing packages except header
            while (packagesList.children.length > 1) {
                packagesList.removeChild(packagesList.lastChild);
            }
            
            // Add packages
            packages.forEach((pkg, index) => {
                addPackageToModal(pkg.name, pkg.price, pkg.duration, index);
            });
        }
        
        function addPackageToModal(name = '', price = '', duration = '', index = null) {
            const packagesList = document.getElementById('packagesList');
            
            const packageItem = document.createElement('div');
            packageItem.className = 'package-item';
            packageItem.dataset.index = index !== null ? index : packagesList.children.length - 1;
            
            packageItem.innerHTML = `
                <div class="package-field">
                    <input type="text" class="package-name" value="${name}" placeholder="Nama Paket">
                </div>
                <div class="package-field">
                    <input type="number" class="package-price" value="${price}" placeholder="Harga" min="0">
                </div>
                <div class="package-field">
                    <input type="text" class="package-duration" value="${duration}" placeholder="Durasi">
                </div>
                <div class="package-actions">
                    <button type="button" class="btn-icon btn-danger" onclick="removePackageFromModal(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            packagesList.appendChild(packageItem);
        }
        
        function removePackageFromModal(button) {
            const packageItem = button.closest('.package-item');
            packageItem.remove();
        }
        
        function savePackages() {
            const productId = parseInt(document.getElementById('currentProductId').value);
            const productIndex = products.findIndex(p => p.id === productId);
            
            if (productIndex === -1) return;
            
            // Collect packages from modal
            const packages = [];
            const packageItems = document.querySelectorAll('.package-item:not(.package-item-header)');
            
            packageItems.forEach(item => {
                const name = item.querySelector('.package-name').value.trim();
                const price = parseInt(item.querySelector('.package-price').value) || 0;
                const duration = item.querySelector('.package-duration').value.trim();
                
                if (name && price > 0 && duration) {
                    packages.push({ name, price, duration });
                }
            });
            
            // Save to product
            products[productIndex].packages = packages;
            
            // Update price based on packages
            if (packages.length > 0) {
                const minPrice = Math.min(...packages.map(p => p.price));
                const maxPrice = Math.max(...packages.map(p => p.price));
                
                products[productIndex].price = minPrice;
                products[productIndex].originalPrice = maxPrice * 1.5;
                
                if (products[productIndex].originalPrice > minPrice) {
                    products[productIndex].discount = Math.round(((products[productIndex].originalPrice - minPrice) / products[productIndex].originalPrice) * 100);
                }
            }
            
            saveProducts();
            showNotification('Paket berhasil disimpan');
            closePackagesModal();
            
            // Update UI
            loadProductsManagement();
            loadDashboardProducts();
            updateStats();
        }
        
        function closePackagesModal() {
            document.getElementById('packagesModal').classList.remove('active');
            document.getElementById('newPackageName').value = '';
            document.getElementById('newPackagePrice').value = '';
            document.getElementById('newPackageDuration').value = '';
        }

        // ==================== SYSTEM FUNCTIONS ====================
        
        function syncProducts() {
            console.log(' Sinkronisasi produk dari file...');
            
            // Load new products from files
            const newProducts = loadProductsMethod1();
            
            // Merge with existing products
            const mergedProducts = mergeProducts(products, newProducts);
            
            // Update data
            products = mergedProducts;
            categories = generateCategories();
            currentProductId = products.length > 0 ? Math.max(...products.map(p => p.id)) : 0;
            
            // Save
            saveProducts();
            saveCategories();
            
            // Update UI
            updateStats();
            loadDashboardProducts();
            loadProductsManagement();
            updateCategoryDropdown(); // PERBAIKAN: Update dropdown setelah sync
            
            showNotification('Produk berhasil disinkronkan!', 'success');
        }
        
        function mergeProducts(existingProducts, newProducts) {
            const merged = [...existingProducts];
            const existingMap = new Map();
            
            // Create map of existing products
            existingProducts.forEach((product, index) => {
                const key = normalizeProductKey(product.name);
                existingMap.set(key, index);
            });
            
            // Add/update new products
            newProducts.forEach(newProduct => {
                const key = normalizeProductKey(newProduct.name);
                
                if (existingMap.has(key)) {
                    // Update existing product
                    const index = existingMap.get(key);
                    merged[index] = {
                        ...merged[index],
                        ...newProduct,
                        id: merged[index].id, // Keep old ID
                        packages: newProduct.packages || merged[index].packages
                    };
                } else {
                    // Add new product
                    merged.push(newProduct);
                }
            });
            
            return merged;
        }
        
        function resetData() {
            if (!confirm('Reset semua data produk?\nData akan dimuat ulang dari file. Lanjutkan?')) return;
            
            console.log(' Reset data...');
            
            // Clear localStorage
            localStorage.removeItem('admin_products');
            localStorage.removeItem('admin_categories');
            
            // Reload from files
            products = loadProductsMethod1();
            categories = generateCategories();
            currentProductId = products.length;
            
            // Save
            saveProducts();
            saveCategories();
            
            // Update UI
            updateStats();
            loadDashboardProducts();
            loadProductsManagement();
            updateCategoryDropdown(); // PERBAIKAN: Update dropdown setelah reset
            
            showNotification('Data berhasil direset!', 'success');
        }
        
        function checkDataConsistency() {
            console.log(' Mengecek konsistensi data...');
            
            // Check for duplicates
            const nameSet = new Set();
            const duplicates = [];
            
            products.forEach(product => {
                const key = normalizeProductKey(product.name);
                if (nameSet.has(key)) {
                    duplicates.push(product.name);
                } else {
                    nameSet.add(key);
                }
            });
            
            if (duplicates.length > 0) {
                console.error(' Duplikasi ditemukan:', duplicates);
                showNotification(`Peringatan: ${duplicates.length} duplikasi ditemukan`, 'warning');
                return false;
            }
            
            // Check products without packages
            const productsWithoutPackages = products.filter(p => !p.packages || p.packages.length === 0);
            if (productsWithoutPackages.length > 0) {
                console.warn(' Produk tanpa paket:', productsWithoutPackages.map(p => p.name));
            }
            
            console.log(' Data konsisten');
            return true;
        }
        
        function saveSettings() {
            try {
                const settings = {
                    storeName: document.getElementById('storeName').value,
                    adminWhatsApp: document.getElementById('adminWhatsApp').value,
                    adminEmail: document.getElementById('adminEmail').value,
                    autoSync: document.getElementById('autoSync').value,
                    autoRedirect: document.getElementById('autoRedirect').value
                };
                localStorage.setItem('admin_settings', JSON.stringify(settings));
                showNotification('Pengaturan berhasil disimpan');
            } catch (e) {
                console.error('Error:', e);
                showNotification('Gagal menyimpan pengaturan', 'error');
            }
        }
        
        function loadSettings() {
            const savedSettings = localStorage.getItem('admin_settings');
            if (savedSettings) {
                try {
                    const settings = JSON.parse(savedSettings);
                    document.getElementById('storeName').value = settings.storeName || 'GIVASTORE.ID';
                    document.getElementById('adminWhatsApp').value = settings.adminWhatsApp || '6285189139082';
                    document.getElementById('adminEmail').value = settings.adminEmail || 'xyzopedia@gmail.com';
                    document.getElementById('autoSync').value = settings.autoSync || 'yes';
                    document.getElementById('autoRedirect').value = settings.autoRedirect || 'yes';
                } catch (e) {
                    console.error('Error:', e);
                }
            }
        }

        // ==================== EVENT LISTENERS ====================
        
        function setupEventListeners() {
            // Mobile menu toggle
            document.getElementById('mobileMenuToggle').addEventListener('click', () => {
                document.getElementById('sidebar').classList.toggle('active');
            });
            
            // Menu navigation
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active menu
                    document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update page title
                    const pageName = this.querySelector('span').textContent;
                    document.getElementById('pageTitle').textContent = pageName;
                    
                    // Show corresponding content
                    const pageId = this.getAttribute('data-page');
                    document.querySelectorAll('.page-content').forEach(content => {
                        content.style.display = 'none';
                    });
                    document.getElementById(`${pageId}Content`).style.display = 'block';
                    
                    // Load data if needed
                    switch(pageId) {
                        case 'products':
                            loadProductsManagement();
                            break;
                        case 'categories':
                            loadCategories();
                            break;
                        case 'images':
                            loadImages();
                            break;
                        case 'banners':
                            loadBanners();
                            break;
                        case 'stock':
                            loadStockManagement();
                            break;
                        case 'orders':
                            loadOrders();
                            break;
                        case 'settings':
                            loadSettings();
                            break;
                    }
                    
                    // Close mobile sidebar
                    if (window.innerWidth <= 992) {
                        document.getElementById('sidebar').classList.remove('active');
                    }
                });
            });
            
            // Sync button
            document.getElementById('syncProductsBtn').addEventListener('click', syncProducts);
            
            // Reset button
            document.getElementById('resetDataBtn').addEventListener('click', resetData);
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', () => {
                if (confirm('Logout dari admin panel?')) {
                    window.location.href = 'index.html';
                }
            });
            
            // Save settings
            document.getElementById('saveSettings').addEventListener('click', saveSettings);
            
            // Product modal
            document.getElementById('addProductBtn').addEventListener('click', () => {
                document.getElementById('productForm').reset();
                document.getElementById('productId').value = '';
                document.getElementById('productImagePreview').src = 'https://via.placeholder.com/100/1E40AF/FFFFFF?text=Produk';
                document.getElementById('productModalTitle').textContent = 'Tambah Produk Baru';
                
                // PERBAIKAN: Pastikan dropdown terisi sebelum modal terbuka
                populateCategoryDropdown();
                
                document.getElementById('productModal').classList.add('active');
            });
            
            document.getElementById('productForm').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const productData = {
                    name: document.getElementById('productName').value,
                    category: document.getElementById('productCategory').value,
                    price: parseInt(document.getElementById('productPrice').value) || 0,
                    originalPrice: parseInt(document.getElementById('productOriginalPrice').value) || 0,
                    stock: parseInt(document.getElementById('productStock').value) || 0,
                    image: document.getElementById('productImagePreview').src,
                    pageUrl: document.getElementById('productUrl').value,
                    description: document.getElementById('productDescription').value,
                    isFlashSale: document.getElementById('productFlashSale').value === 'yes',
                    isPopular: document.getElementById('productPopular').value === 'yes',
                    packages: []
                };
                
                const productId = document.getElementById('productId').value;
                
                if (productId) {
                    updateProduct(parseInt(productId), productData);
                } else {
                    addProduct(productData);
                }
                
                document.getElementById('productModal').classList.remove('active');
            });
            
            document.getElementById('productImage').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('productImagePreview').src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            document.getElementById('closeProductModal').addEventListener('click', () => {
                document.getElementById('productModal').classList.remove('active');
            });
            
            document.getElementById('cancelProduct').addEventListener('click', () => {
                document.getElementById('productModal').classList.remove('active');
            });
            
            // Packages modal
            document.getElementById('addPackageBtn').addEventListener('click', () => {
                const name = document.getElementById('newPackageName').value.trim();
                const price = document.getElementById('newPackagePrice').value;
                const duration = document.getElementById('newPackageDuration').value.trim();
                
                if (!name || !price || !duration) {
                    showNotification('Harap isi semua field', 'error');
                    return;
                }
                
                addPackageToModal(name, price, duration);
                
                // Clear form
                document.getElementById('newPackageName').value = '';
                document.getElementById('newPackagePrice').value = '';
                document.getElementById('newPackageDuration').value = '';
            });
            
            document.getElementById('savePackages').addEventListener('click', savePackages);
            document.getElementById('cancelPackages').addEventListener('click', closePackagesModal);
            document.getElementById('closePackagesModal').addEventListener('click', closePackagesModal);
            
            // Category modal
            document.getElementById('addCategoryBtn').addEventListener('click', () => {
                document.getElementById('categoryForm').reset();
                document.getElementById('categoryId').value = '';
                document.getElementById('categoryModalTitle').textContent = 'Tambah Kategori Baru';
                document.getElementById('categoryModal').classList.add('active');
            });
            
            document.getElementById('categoryForm').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const name = document.getElementById('categoryName').value;
                const categoryId = document.getElementById('categoryId').value;
                
                if (categoryId) {
                    updateCategory(parseInt(categoryId), name);
                } else {
                    addCategory(name);
                }
                
                document.getElementById('categoryModal').classList.remove('active');
            });
            
            document.getElementById('closeCategoryModal').addEventListener('click', () => {
                document.getElementById('categoryModal').classList.remove('active');
            });
            
            document.getElementById('cancelCategory').addEventListener('click', () => {
                document.getElementById('categoryModal').classList.remove('active');
            });
            
            // Banner modal
            document.getElementById('addBannerBtn').addEventListener('click', () => {
                document.getElementById('bannerForm').reset();
                document.getElementById('bannerId').value = '';
                document.getElementById('bannerImagePreview').src = 'https://via.placeholder.com/300x100/0A1931/FFFFFF?text=Banner';
                document.getElementById('bannerModalTitle').textContent = 'Tambah Banner Baru';
                document.getElementById('bannerModal').classList.add('active');
            });
            
            document.getElementById('bannerForm').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const bannerData = {
                    title: document.getElementById('bannerTitle').value,
                    image: document.getElementById('bannerImagePreview').src,
                    url: document.getElementById('bannerUrl').value
                };
                
                const bannerId = document.getElementById('bannerId').value;
                
                if (bannerId) {
                    updateBanner(parseInt(bannerId), bannerData);
                } else {
                    addBanner(bannerData);
                }
                
                document.getElementById('bannerModal').classList.remove('active');
            });
            
            document.getElementById('bannerImage').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('bannerImagePreview').src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            document.getElementById('closeBannerModal').addEventListener('click', () => {
                document.getElementById('bannerModal').classList.remove('active');
            });
            
            document.getElementById('cancelBanner').addEventListener('click', () => {
                document.getElementById('bannerModal').classList.remove('active');
            });
            
            // Image upload
            document.getElementById('uploadImage').addEventListener('change', (e) => {
                const files = e.target.files;
                for (let file of files) {
                    uploadImage(file);
                }
                e.target.value = '';
            });
            
            // Close modals on outside click
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });
            
            // Close modals on Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal.active').forEach(modal => {
                        modal.classList.remove('active');
                    });
                }
            });
            
            // Window resize
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    if (window.innerWidth > 992 && document.getElementById('sidebar').classList.contains('active')) {
                        document.getElementById('sidebar').classList.remove('active');
                    }
                }, 250);
            });
        }

        // ==================== GLOBAL FUNCTIONS ====================
        
        window.editProduct = editProduct;
        window.deleteProduct = deleteProduct;
        window.editCategory = editCategory;
        window.deleteCategory = deleteCategory;
        window.editBanner = editBanner;
        window.deleteBanner = deleteBanner;
        window.useImage = function(url) {
            navigator.clipboard.writeText(url).then(() => {
                showNotification('URL gambar disalin ke clipboard');
            }).catch(err => {
                console.error('Failed to copy:', err);
                showNotification('Gagal menyalin URL', 'error');
            });
        };
        window.deleteImage = deleteImage;
        window.updateStock = updateStock;
        window.setSoldOut = setSoldOut;
        window.openManagePackages = openManagePackages;
        window.removePackageFromModal = removePackageFromModal;
        window.syncProducts = syncProducts;
        window.resetData = resetData;

        // ==================== INITIALIZATION ====================
        
        function init() {
            console.log(' Admin Panel GIVASTORE.ID diinisialisasi...');
            console.log(' Menggunakan METODE 1: produk.js (utama) + products-data.js (tambahan)');
            
            // Load data
            loadData();
            
            // Setup event listeners
            setupEventListeners();
            
            console.log(' Sistem siap digunakan');
        }
        
        // Start the application
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>